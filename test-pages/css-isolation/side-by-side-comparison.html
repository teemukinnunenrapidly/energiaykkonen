<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow DOM vs Namespace Side-by-Side</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .comparison-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .widget-section { border: 2px solid #ddd; border-radius: 8px; padding: 20px; }
        .shadow-section { border-color: #2196f3; }
        .namespace-section { border-color: #ff9800; }
        .section-title { text-align: center; font-weight: bold; margin-bottom: 20px; padding: 10px; }
        .shadow-title { background: #e3f2fd; color: #1976d2; }
        .namespace-title { background: #fff3e0; color: #f57c00; }
        
        /* Conflicting styles */
        .card { background: red !important; color: white !important; padding: 20px !important; }
        input, button { background: yellow !important; border: 3px solid green !important; }
        
        .stats { background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 15px; }
        .stats h4 { margin: 0 0 10px 0; }
        
        @media (max-width: 768px) {
            .comparison-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <h1>Shadow DOM vs Namespace CSS Isolation Comparison</h1>
    <p>This page compares both isolation methods side by side with identical conflicting external styles.</p>
    
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <strong>External Conflicting Styles Active:</strong>
        <ul>
            <li>All .card elements: red background, white text</li>
            <li>All inputs/buttons: yellow background, green border</li>
        </ul>
    </div>
    
    <div class="comparison-grid">
        <div class="widget-section shadow-section">
            <div class="section-title shadow-title">
                üîê Shadow DOM Isolation
            </div>
            <div id="shadow-comparison-widget" data-e1-calculator data-shadow="true">
                <!-- Shadow DOM widget -->
            </div>
            <div class="stats" id="shadow-stats">
                <h4>Shadow DOM Stats</h4>
                <div id="shadow-stats-content">Loading...</div>
            </div>
        </div>
        
        <div class="widget-section namespace-section">
            <div class="section-title namespace-title">
                üì¶ Namespace Isolation
            </div>
            <div id="namespace-comparison-widget" data-e1-calculator data-shadow="false">
                <!-- Namespace widget -->
            </div>
            <div class="stats" id="namespace-stats">
                <h4>Namespace Stats</h4>
                <div id="namespace-stats-content">Loading...</div>
            </div>
        </div>
    </div>
    
    <div style="margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
        <h3>External Elements (Should be affected by conflicts)</h3>
        <div class="card" style="margin: 10px 0;">External Card - Should be RED</div>
        <input type="text" placeholder="External input - Should be YELLOW" style="margin: 5px;" />
        <button style="margin: 5px;">External Button - Should be YELLOW</button>
    </div>
    
    <div id="comparison-results" style="margin-top: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
        <h3>Comparison Results</h3>
        <div id="results-content">Running comparison...</div>
    </div>
    
    <script src="../../../dist/e1-calculator-widget.min.js"></script>
    <script>
        let shadowWidget = null;
        let namespaceWidget = null;
        
        async function runComparison() {
            try {
                // Initialize both widgets
                shadowWidget = await window.E1Calculator.init('shadow-comparison-widget', { useShadowDOM: true });
                namespaceWidget = await window.E1Calculator.init('namespace-comparison-widget', { useShadowDOM: false });
                
                // Update stats
                updateShadowStats();
                updateNamespaceStats();
                updateComparisonResults();
                
            } catch (error) {
                document.getElementById('results-content').innerHTML = 'Comparison failed: ' + error.message;
            }
        }
        
        function updateShadowStats() {
            const statsContent = document.getElementById('shadow-stats-content');
            
            if (shadowWidget) {
                const container = document.getElementById('shadow-comparison-widget');
                let stats = `<p><strong>Mode:</strong> ${shadowWidget.mode}</p>`;
                stats += `<p><strong>Shadow Root:</strong> ${container.shadowRoot ? 'Yes' : 'No'}</p>`;
                
                if (container.shadowRoot) {
                    const elements = container.shadowRoot.querySelectorAll('*');
                    stats += `<p><strong>Elements:</strong> ${elements.length}</p>`;
                    
                    // Check isolation
                    const cards = container.shadowRoot.querySelectorAll('.card');
                    let isolated = true;
                    cards.forEach(card => {
                        const style = getComputedStyle(card);
                        if (style.backgroundColor.includes('255, 0, 0')) {
                            isolated = false;
                        }
                    });
                    stats += `<p><strong>Isolation:</strong> ${isolated ? '‚úÖ Perfect' : '‚ùå Compromised'}</p>`;
                }
                
                statsContent.innerHTML = stats;
            } else {
                statsContent.innerHTML = '<p>Failed to initialize</p>';
            }
        }
        
        function updateNamespaceStats() {
            const statsContent = document.getElementById('namespace-stats-content');
            
            if (namespaceWidget) {
                const container = document.getElementById('namespace-comparison-widget');
                let stats = `<p><strong>Mode:</strong> ${namespaceWidget.mode}</p>`;
                stats += `<p><strong>Shadow Root:</strong> No (namespace mode)</p>`;
                
                const elements = container.querySelectorAll('.e1-calculator-isolated-root *');
                stats += `<p><strong>Elements:</strong> ${elements.length}</p>`;
                
                // Check isolation
                const cards = container.querySelectorAll('.card');
                let isolated = true;
                cards.forEach(card => {
                    const style = getComputedStyle(card);
                    if (style.backgroundColor.includes('255, 0, 0')) {
                        isolated = false;
                    }
                });
                stats += `<p><strong>Isolation:</strong> ${isolated ? '‚úÖ Working' : '‚ùå Compromised'}</p>`;
                
                statsContent.innerHTML = stats;
            } else {
                statsContent.innerHTML = '<p>Failed to initialize</p>';
            }
        }
        
        function updateComparisonResults() {
            const resultsContent = document.getElementById('results-content');
            
            if (shadowWidget && namespaceWidget) {
                let report = '<h4>Isolation Comparison Results</h4>';
                
                // Test external elements
                const externalCard = document.querySelector('body > div:last-of-type .card');
                const externalStyle = getComputedStyle(externalCard);
                const externalAffected = externalStyle.backgroundColor.includes('255, 0, 0');
                
                report += `<p><strong>External Elements:</strong> ${externalAffected ? '‚úÖ Properly affected by conflicts' : '‚ùå Not affected as expected'}</p>`;
                
                // Performance comparison
                const shadowContainer = document.getElementById('shadow-comparison-widget');
                const namespaceContainer = document.getElementById('namespace-comparison-widget');
                
                const shadowStart = performance.now();
                if (shadowContainer.shadowRoot) {
                    const shadowElements = shadowContainer.shadowRoot.querySelectorAll('*');
                    shadowElements.forEach(el => getComputedStyle(el));
                }
                const shadowEnd = performance.now();
                
                const namespaceStart = performance.now();
                const namespaceElements = namespaceContainer.querySelectorAll('*');
                namespaceElements.forEach(el => getComputedStyle(el));
                const namespaceEnd = performance.now();
                
                report += '<h4>Performance Comparison</h4>';
                report += `<p><strong>Shadow DOM:</strong> ${Math.round(shadowEnd - shadowStart)}ms</p>`;
                report += `<p><strong>Namespace:</strong> ${Math.round(namespaceEnd - namespaceStart)}ms</p>`;
                
                // Memory usage (if available)
                if (performance.memory) {
                    report += '<h4>Memory Usage</h4>';
                    report += `<p><strong>Used Heap:</strong> ${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB</p>`;
                }
                
                resultsContent.innerHTML = report;
            } else {
                resultsContent.innerHTML = '<p>‚ùå One or both widgets failed to initialize</p>';
            }
        }
        
        window.addEventListener('load', () => {
            setTimeout(runComparison, 1000);
        });
    </script>
</body>
</html>