<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress Classic Editor Test</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; }
        .wp-content { max-width: 800px; margin: 0 auto; }
        .shortcode-demo { background: #f9f9f9; padding: 20px; border-left: 4px solid #2271b1; margin: 20px 0; }
        pre { background: #23282d; color: #eee; padding: 15px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="wp-content">
        <h1>WordPress Classic Editor Integration Test</h1>
        
        <h2>Basic Shortcode</h2>
        <div class="shortcode-demo">
            <p><strong>Shortcode:</strong> <code>[e1_calculator]</code></p>
            <div id="basic-shortcode" data-e1-calculator>
                <!-- Basic widget -->
            </div>
        </div>
        
        <h2>Shortcode with Attributes</h2>
        <div class="shortcode-demo">
            <p><strong>Shortcode:</strong> <code>[e1_calculator height="500px" theme="dark" shadow="true"]</code></p>
            <div id="attr-shortcode" data-e1-calculator data-height="500px" data-theme="dark" data-shadow="true">
                <!-- Widget with attributes -->
            </div>
        </div>
        
        <h2>Shortcode in Content</h2>
        <div class="shortcode-demo">
            <p>This simulates a shortcode embedded in post content.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
            
            <div id="content-shortcode" data-e1-calculator data-theme="light">
                <!-- Inline widget -->
            </div>
            
            <p>Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        </div>
        
        <h2>Test Results</h2>
        <div id="test-results" style="padding: 20px; border: 1px solid #ccc; border-radius: 4px;">
            <h3>Loading...</h3>
        </div>
    </div>
    
    <!-- Simulate WordPress environment -->
    <script>
        window.e1CalculatorWP = {
            ajaxUrl: '/wp-admin/admin-ajax.php',
            nonce: 'classic-editor-nonce',
            configNonce: 'config-nonce',
            cacheUrl: '../../dist',
            version: '2.2.0',
            isAdmin: false,
            isBlockEditor: false
        };
    </script>
    
    <script src="../../dist/e1-calculator-widget.min.js"></script>
    <script>
        async function testClassicEditor() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h3>Testing Classic Editor Integration...</h3>';
            
            try {
                // Initialize all widgets
                const instances = await window.E1Calculator.initAll();
                
                let report = '<h3>Classic Editor Test Results</h3>';
                report += `<p>✅ Widgets initialized: ${instances.length}</p>`;
                
                // Test each widget
                instances.forEach((instance, index) => {
                    if (instance) {
                        report += `<p>✅ Widget ${index + 1}: ${instance.mode} mode</p>`;
                    }
                });
                
                // Test shortcode attribute handling
                const attrWidget = instances.find(i => i.elementId === 'attr-shortcode');
                if (attrWidget) {
                    report += '<p>✅ Shortcode attributes processed</p>';
                } else {
                    report += '<p>❌ Shortcode attributes not processed</p>';
                }
                
                // Test inline content embedding
                const contentWidget = instances.find(i => i.elementId === 'content-shortcode');
                if (contentWidget) {
                    report += '<p>✅ Inline content embedding works</p>';
                } else {
                    report += '<p>❌ Inline content embedding failed</p>';
                }
                
                results.innerHTML = report;
                
            } catch (error) {
                results.innerHTML = '<h3>Test Failed</h3><p>' + error.message + '</p>';
            }
        }
        
        window.addEventListener('load', testClassicEditor);
    </script>
</body>
</html>