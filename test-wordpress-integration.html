<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress Integration Test - Build-time Data</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .wp-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #23282d;
            border-bottom: 3px solid #0073aa;
            padding-bottom: 10px;
        }
        
        .info-box {
            background: #e8f5fe;
            border-left: 4px solid #0073aa;
            padding: 15px;
            margin: 20px 0;
        }
        
        .success-box {
            background: #ecf7ed;
            border-left: 4px solid #46b450;
            padding: 15px;
            margin: 20px 0;
        }
        
        .test-container {
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 4px;
        }
        
        .flow-diagram {
            background: #fff;
            border: 2px solid #0073aa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .flow-number {
            background: #0073aa;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .flow-arrow {
            text-align: center;
            color: #0073aa;
            font-size: 20px;
            margin: 10px 0;
        }
        
        .code-block {
            background: #23282d;
            color: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-online { background: #46b450; }
        .status-offline { background: #dc3232; }
        .status-cached { background: #f0b849; }
    </style>
</head>
<body>
    <div class="wp-container">
        <h1>üîå WordPress Integration - Build-time Data Model</h1>
        
        <div class="success-box">
            <strong>‚úÖ Offline Mode Activated!</strong><br>
            Widget toimii nyt t√§ysin offline-datalla ilman Supabase-yhteytt√§.
        </div>
        
        <div class="flow-diagram">
            <h2>Data Flow Architecture</h2>
            
            <div class="flow-step">
                <div class="flow-number">1</div>
                <div>
                    <strong>Build-vaihe (Next.js)</strong><br>
                    <code>npm run build:widget && node scripts/deploy-to-wordpress.js</code>
                </div>
            </div>
            
            <div class="flow-arrow">‚Üì</div>
            
            <div class="flow-step">
                <div class="flow-number">2</div>
                <div>
                    <strong>Hae Supabasesta</strong><br>
                    <span class="status-indicator status-online"></span> 9 cards | 2 visual objects | 5 formulas
                </div>
            </div>
            
            <div class="flow-arrow">‚Üì</div>
            
            <div class="flow-step">
                <div class="flow-number">3</div>
                <div>
                    <strong>Pakkaa config.json</strong><br>
                    <span class="status-indicator status-cached"></span> 12.9 KB data bundle
                </div>
            </div>
            
            <div class="flow-arrow">‚Üì</div>
            
            <div class="flow-step">
                <div class="flow-number">4</div>
                <div>
                    <strong>WordPress Cache</strong><br>
                    <code>/wordpress-plugin/e1-calculator-pro/cache/</code>
                </div>
            </div>
            
            <div class="flow-arrow">‚Üì</div>
            
            <div class="flow-step">
                <div class="flow-number">5</div>
                <div>
                    <strong>Widget toimii offline</strong><br>
                    <span class="status-indicator status-offline"></span> Ei tarvitse Supabase-yhteytt√§!
                </div>
            </div>
        </div>
        
        <div class="info-box">
            <h3>üì¶ Cache Contents:</h3>
            <ul>
                <li><strong>widget.js</strong> (1.3 MB) - Bundled React application</li>
                <li><strong>widget.css</strong> (7 KB) - Widget styles</li>
                <li><strong>config.json</strong> (12.9 KB) - All data from Supabase</li>
                <li><strong>metadata.json</strong> - Version and build info</li>
            </ul>
        </div>
        
        <h2>WordPress Shortcode:</h2>
        <div class="code-block">[e1_calculator theme="light" height="600"]</div>
        
        <div class="test-container">
            <h3>Live Widget Test (from cache):</h3>
            
            <!-- WordPress-style widget container -->
            <div id="e1-calculator-widget-test" 
                 class="e1-calculator-widget-container" 
                 data-type="default" 
                 data-theme="light"
                 data-config-url="wordpress-plugin/e1-calculator-pro/cache/config.json"
                 style="min-height: 600px;">
                <div class="e1-calculator-loading">
                    <div class="e1-loading-spinner"></div>
                    <p>Loading widget from cache...</p>
                </div>
            </div>
        </div>
        
        <div class="success-box">
            <h3>‚úÖ Verification Checklist:</h3>
            <ul>
                <li>‚òëÔ∏è Data fetched at build time from Supabase</li>
                <li>‚òëÔ∏è Data bundled into config.json (12.9 KB)</li>
                <li>‚òëÔ∏è Widget loads from cache directory</li>
                <li>‚òëÔ∏è No Supabase connection required at runtime</li>
                <li>‚òëÔ∏è Progressive image loading from Cloudflare</li>
                <li>‚òëÔ∏è All 9 cards available offline</li>
            </ul>
        </div>
        
        <div class="info-box">
            <h3>üîÑ Update Process:</h3>
            <ol>
                <li>Make changes in Next.js admin panel</li>
                <li>Run: <code>npm run build:widget</code></li>
                <li>Run: <code>node scripts/deploy-to-wordpress.js</code></li>
                <li>WordPress automatically uses new cache</li>
            </ol>
        </div>
    </div>
    
    <!-- Load widget files from WordPress cache -->
    <link rel="stylesheet" href="wordpress-plugin/e1-calculator-pro/cache/widget.css">
    <script src="wordpress-plugin/e1-calculator-pro/cache/widget.js"></script>
    
    <!-- Initialize widget with offline config -->
    <script>
        // Simulate WordPress environment
        window.e1CalculatorData = {
            apiUrl: '/wp-json/e1-calculator/v1/',
            ajaxUrl: '/wp-admin/admin-ajax.php',
            nonce: 'test-nonce-123',
            locale: 'fi_FI'
        };
        
        // Widget initialization
        (function() {
            'use strict';
            
            function initWidget() {
                if (typeof window.E1Calculator === 'undefined') {
                    setTimeout(initWidget, 100);
                    return;
                }
                
                console.log('‚úÖ E1Calculator loaded, initializing with offline data...');
                
                // Widget configuration
                const config = {
                    configUrl: 'wordpress-plugin/e1-calculator-pro/cache/config.json',
                    cloudflareAccountHash: 'AkEHl6uYQM8NNRufIXHzFw',
                    theme: 'light',
                    showVisualSupport: true,
                    progressiveImageLoading: true
                };
                
                // Initialize
                try {
                    window.E1Calculator.init('e1-calculator-widget-test', config);
                    console.log('‚úÖ Widget initialized with offline data!');
                    
                    // Hide loading message
                    const loadingEl = document.querySelector('.e1-calculator-loading');
                    if (loadingEl) {
                        loadingEl.style.display = 'none';
                    }
                } catch (error) {
                    console.error('‚ùå Widget initialization error:', error);
                }
            }
            
            // Start when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initWidget);
            } else {
                initWidget();
            }
        })();
    </script>
</body>
</html>