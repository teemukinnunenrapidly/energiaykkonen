<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress Plugin Simulation - E1 Calculator</title>
    <style>
        /* WordPress-like styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            background: #f0f0f1;
            margin: 0;
            padding: 0;
        }
        
        /* Admin bar simulation */
        .wp-admin-bar {
            background: #23282d;
            height: 32px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            color: #fff;
            font-size: 13px;
        }
        
        /* Admin panel */
        .wp-admin {
            display: flex;
            min-height: calc(100vh - 32px);
        }
        
        .wp-admin-menu {
            width: 160px;
            background: #23282d;
            padding: 12px 0;
        }
        
        .wp-admin-content {
            flex: 1;
            padding: 20px;
            background: #fff;
            margin: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 1px rgba(0,0,0,.04);
        }
        
        h1 {
            font-size: 23px;
            font-weight: 400;
            margin: 0 0 20px;
            padding: 0;
            line-height: 1.3;
        }
        
        .wp-button {
            display: inline-block;
            text-decoration: none;
            font-size: 13px;
            line-height: 2.15384615;
            min-height: 30px;
            margin: 0;
            padding: 0 10px;
            cursor: pointer;
            border: 1px solid #2271b1;
            border-radius: 3px;
            white-space: nowrap;
            box-sizing: border-box;
            background: #2271b1;
            color: #fff;
            margin-right: 8px;
        }
        
        .wp-button:hover {
            background: #135e96;
            border-color: #135e96;
        }
        
        .wp-button-secondary {
            background: #f0f0f1;
            border-color: #787c82;
            color: #2c3338;
        }
        
        .wp-button-secondary:hover {
            background: #f6f7f7;
            border-color: #8e9196;
        }
        
        .settings-section {
            background: #fff;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .settings-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .settings-label {
            width: 200px;
            font-weight: 600;
        }
        
        .settings-value {
            flex: 1;
            font-family: monospace;
            background: #f0f0f1;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .sync-status {
            padding: 10px;
            margin: 15px 0;
            border-radius: 3px;
            display: none;
        }
        
        .sync-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .sync-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .preview-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #c3c4c7;
        }
        
        #calculator-preview {
            width: 100%;
            height: 600px;
            border: 1px solid #c3c4c7;
            border-radius: 4px;
            background: #fff;
        }
        
        .config-display {
            background: #f6f7f7;
            border: 1px solid #c3c4c7;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            border-radius: 3px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            display: none;
        }
        
        .last-sync {
            color: #50575e;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- WordPress Admin Bar -->
    <div class="wp-admin-bar">
        WordPress Admin - E1 Calculator Settings
    </div>
    
    <!-- WordPress Admin Panel -->
    <div class="wp-admin">
        <!-- Sidebar Menu -->
        <div class="wp-admin-menu"></div>
        
        <!-- Main Content -->
        <div class="wp-admin-content">
            <h1>E1 Calculator Settings</h1>
            
            <!-- Settings Section -->
            <div class="settings-section">
                <h2>Plugin Configuration</h2>
                
                <div class="settings-row">
                    <div class="settings-label">Calculator URL:</div>
                    <div class="settings-value">http://localhost:3001</div>
                </div>
                
                <div class="settings-row">
                    <div class="settings-label">Plugin Version:</div>
                    <div class="settings-value">1.1.0</div>
                </div>
                
                <div class="settings-row">
                    <div class="settings-label">API Endpoint:</div>
                    <div class="settings-value">/api/widget-config</div>
                </div>
                
                <div class="last-sync" id="last-sync">Last sync: Never</div>
                
                <div style="margin-top: 20px;">
                    <button class="wp-button wp-button-secondary" onclick="testConnection()">Test Connection</button>
                    <button class="wp-button" onclick="syncConfiguration()">Sync Changes</button>
                    <button class="wp-button wp-button-secondary" onclick="toggleConfig()">Show Configuration</button>
                </div>
                
                <div id="sync-status" class="sync-status"></div>
                
                <div id="config-display" class="config-display"></div>
            </div>
            
            <!-- Shortcode Info -->
            <div class="settings-section">
                <h2>Usage</h2>
                <p>Use the following shortcode to embed the calculator in any page or post:</p>
                <code style="background: #f0f0f1; padding: 8px 12px; display: inline-block; border-radius: 3px;">
                    [e1_calculator]
                </code>
            </div>
            
            <!-- Preview Section -->
            <div class="preview-section">
                <h2>Live Preview</h2>
                <p>This shows how the calculator will appear on your website:</p>
                
                <iframe 
                    id="calculator-preview"
                    src="http://localhost:3001"
                    title="E1 Calculator Preview">
                </iframe>
            </div>
        </div>
    </div>
    
    <script>
        let currentConfig = null;
        
        // Test connection to the calculator API
        async function testConnection() {
            const statusEl = document.getElementById('sync-status');
            statusEl.className = 'sync-status';
            statusEl.textContent = 'Testing connection...';
            statusEl.style.display = 'block';
            
            try {
                const response = await fetch('http://localhost:3001/api/widget-config');
                
                if (response.ok) {
                    statusEl.className = 'sync-status success';
                    statusEl.textContent = '✓ Connection successful! API is accessible.';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusEl.className = 'sync-status error';
                statusEl.textContent = '✗ Connection failed: ' + error.message;
            }
        }
        
        // Sync configuration from the calculator
        async function syncConfiguration() {
            const statusEl = document.getElementById('sync-status');
            const configEl = document.getElementById('config-display');
            const lastSyncEl = document.getElementById('last-sync');
            
            statusEl.className = 'sync-status';
            statusEl.textContent = 'Syncing configuration...';
            statusEl.style.display = 'block';
            
            try {
                const response = await fetch('http://localhost:3001/api/widget-config');
                const config = await response.json();
                
                currentConfig = config;
                
                // Update display
                configEl.textContent = JSON.stringify(config, null, 2);
                
                // Update last sync time
                const now = new Date();
                lastSyncEl.textContent = 'Last sync: ' + now.toLocaleString();
                
                // Apply theme to preview
                if (config.styling) {
                    applyThemeToPreview(config.styling);
                }
                
                statusEl.className = 'sync-status success';
                statusEl.textContent = '✓ Configuration synced successfully! Version: ' + config.version;
                
                // Store in localStorage (simulating WordPress options)
                localStorage.setItem('e1_calculator_config', JSON.stringify(config));
                localStorage.setItem('e1_calculator_last_sync', now.toISOString());
                
            } catch (error) {
                statusEl.className = 'sync-status error';
                statusEl.textContent = '✗ Sync failed: ' + error.message;
            }
        }
        
        // Toggle configuration display
        function toggleConfig() {
            const configEl = document.getElementById('config-display');
            const button = event.target;
            
            if (configEl.style.display === 'none' || !configEl.style.display) {
                configEl.style.display = 'block';
                button.textContent = 'Hide Configuration';
                
                if (!currentConfig) {
                    configEl.textContent = 'No configuration loaded. Click "Sync Changes" first.';
                }
            } else {
                configEl.style.display = 'none';
                button.textContent = 'Show Configuration';
            }
        }
        
        // Apply theme to preview iframe
        function applyThemeToPreview(styling) {
            const iframe = document.getElementById('calculator-preview');
            
            // Send theme update message to iframe
            iframe.contentWindow.postMessage({
                type: 'theme-update',
                theme: styling
            }, '*');
            
            console.log('Theme applied to preview:', styling);
        }
        
        // Handle resize messages from iframe
        window.addEventListener('message', function(event) {
            if (event.data.type === 'calculator-resize') {
                const iframe = document.getElementById('calculator-preview');
                iframe.style.height = event.data.height + 'px';
                console.log('Preview resized to:', event.data.height);
            }
        });
        
        // Load saved configuration on page load
        window.addEventListener('load', function() {
            const savedConfig = localStorage.getItem('e1_calculator_config');
            const lastSync = localStorage.getItem('e1_calculator_last_sync');
            
            if (savedConfig) {
                currentConfig = JSON.parse(savedConfig);
                document.getElementById('config-display').textContent = JSON.stringify(currentConfig, null, 2);
            }
            
            if (lastSync) {
                const date = new Date(lastSync);
                document.getElementById('last-sync').textContent = 'Last sync: ' + date.toLocaleString();
            }
        });
    </script>
</body>
</html>