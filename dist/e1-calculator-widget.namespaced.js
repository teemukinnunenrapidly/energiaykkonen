!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.E1Calculator=t():e.E1Calculator=t()}(this,function(){return function(){var e,t,o,r,n,i={215:function(){},221:function(e,t,o){"use strict";o.d(t,{x3:function(){return a}});var r=o(307),n=o(215);async function i(e){const{data:t,error:o}=await n.supabase.from("formula_lookups").select("\n      *,\n      formula_lookup_conditions (*)\n    ").eq("name",e).eq("is_active",!0).single();if(o){if("PGRST116"===o.code)return null;throw console.error("Error fetching formula lookup:",o),o}return{...t,conditions:t.formula_lookup_conditions?.sort((e,t)=>e.condition_order-t.condition_order)||[]}}async function a(e,t,o){try{if(console.log(`🔍 [LOOKUP] Processing lookup: "${e}"`),o){console.log("🔍 [LOOKUP] Storing form data to session for lookup processing:",o);for(const[e,n]of Object.entries(o))null!=n&&""!==n&&(0,r.storeSessionField)(t,e,n)}const n=await i(e);if(!n)return{success:!1,error:`Lookup table '${e}' not found in database. Please create it in the Calculations page.`};console.log(`🔍 [LOOKUP] Found table with ${n.conditions?.length||0} conditions`);const{fields:a,calculations:l}=(0,r.getSessionSummary)(t);console.log("🔍 [LOOKUP DEBUG] Session data available:",a),console.log("🔍 [LOOKUP DEBUG] Session calculations available:",l),console.log("🔍 [LOOKUP DEBUG] Field keys:",Object.keys(a)),console.log("🔍 [LOOKUP DEBUG] Calculation keys:",Object.keys(l)),console.log("🔍 [LOOKUP DEBUG] Specifically looking for 'valitse' field:",(0,r.getSessionField)(t,"valitse")),console.log("🔍 [LOOKUP DEBUG] Looking for energy calculation:",l["Laskennallinen energiantarve (kwh)"]);for(const e of n.conditions||[]){if(!e.is_active)continue;console.log(`🔍 [LOOKUP] Evaluating condition ${n.conditions?.indexOf(e)??0}: "${e.condition_rule}"`),console.log(`🔍 [LOOKUP] Target shortcode: "${e.target_shortcode}"`);const o=await s(e.condition_rule,t);if(console.log("🔍 [LOOKUP] Condition evaluation result:",o),o.success){if(o.result)return console.log(`✅ [LOOKUP] Condition matched! Returning: "${e.target_shortcode}"`),{success:!0,shortcode:e.target_shortcode};o.success?console.log("❌ [LOOKUP] Condition evaluated but returned false"):console.log(`⚠️ [LOOKUP] Condition evaluation failed: ${o.error}`)}else console.log(`❌ [LOOKUP] Condition evaluation failed: ${o.error}`)}console.log(`❌ [LOOKUP] No conditions matched for '${e}'`),console.log("🔍 [LOOKUP DEBUG] Final session data summary:",(0,r.getSessionSummary)(t));const c=(0,r.getSessionSummary)(t).fields;return{success:!1,error:`No conditions matched in lookup table '${e}'. Debug info: Available field values: ${Object.entries(c).map(e=>{let[t,o]=e;return`${t}="${o}"`}).join(", ")}`}}catch(e){return{success:!1,error:`Lookup processing failed: ${e instanceof Error?e.message:"Unknown error"}`}}}async function s(e,t){try{if(console.log(`🔍 [LOOKUP] Evaluating condition: "${e}"`),"true"===e.trim())return{success:!0,result:!0};const{fields:o}=(0,r.getSessionSummary)(t);console.log("🔍 [LOOKUP DEBUG] All session fields:",Object.keys(o)),console.log("🔍 [LOOKUP DEBUG] Session field values:",o);let n=e;const i=e.match(/\[field:([^\]]+)\]/g)||[];for(const e of i){const o=e.replace(/\[field:([^\]]+)\]/,"$1").trim();let i=(0,r.getSessionField)(t,o);if(console.log(`🔍 [LOOKUP DEBUG] Looking for field '${o}', got value:`,i),void 0===i){const{fields:e}=(0,r.getSessionSummary)(t);console.log(`🔍 [LOOKUP DEBUG] Field '${o}' not found, trying field mapping...`),console.log("🔍 [LOOKUP DEBUG] Available session fields:",Object.keys(e));const n={valitse:["vesikiertoinen","valitse","heating_type","lämmitystyyppi"],heating_type:["vesikiertoinen","valitse","heating_type","lämmitystyyppi"],neliot:["square_meters","neliot","m2"],korkeus:["ceiling_height","huonekorkeus","korkeus"],henkilomaara:["residents","henkilomaara","henkilomaara"],rakennusvuosi:["construction_year","rakennusvuosi"]}[o.toLowerCase()]||[o];for(const t of n){const r=e[t];if(void 0!==r){console.log(`🔍 [LOOKUP DEBUG] Found field mapping: '${o}' → '${t}' = ${r}`),i=r;break}}}if(void 0===i)return console.error(`🔍 [LOOKUP DEBUG] Field '${o}' not found in session data for sessionId: ${t}`),{success:!1,error:`Field '${o}' not found in session data`};const a="string"==typeof i?`"${i}"`:i;n=n.replace(e,a.toString())}const a=n.match(/\[calc:([^\]]+)\]/g)||[];for(const e of a){const o=e.replace(/\[calc:([^\]]+)\]/,"$1").trim(),i=await(0,r.getSessionCalculation)(t,o);if(!i)return{success:!1,error:`Calculation '${o}' not found in session data`};n=n.replace(e,i.value.toString())}console.log(`🔍 [LOOKUP] Processed condition: "${n}"`),console.log("🔍 [LOOKUP] Testing regex match for condition...");const s=/^[\p{L}\p{N}\s"'=!<>()._-]+$/u.test(n);if(console.log(`🔍 [LOOKUP] Regex test result: ${s}`),console.log("🔍 [LOOKUP] Failed characters (if any):",n.match(/[^\p{L}\p{N}\s"'=!<>()._-]/gu)),!s)return{success:!1,error:`Unsafe characters in condition: ${n}`};console.log(`🔍 [LOOKUP] About to evaluate: ${n}`);const l=new Function("return "+n)();if(console.log(`🔍 [LOOKUP] Condition result: ${l} (type: ${typeof l})`),console.log(`🔍 [LOOKUP] Boolean result: ${Boolean(l)}`),n.includes("==")){const e=n.split("==").map(e=>e.trim());console.log("🔍 [LOOKUP] Comparison parts:",e),console.log(`🔍 [LOOKUP] Left side: ${e[0]} (length: ${e[0]?.length})`),console.log(`🔍 [LOOKUP] Right side: ${e[1]} (length: ${e[1]?.length})`)}return{success:!0,result:Boolean(l)}}catch(e){return{success:!1,error:`Condition evaluation failed: ${e instanceof Error?e.message:"Unknown error"}`}}}},307:function(){},489:function(e,t,o){"use strict";o.d(t,{E1CalculatorWidget:function(){return V}});var r=o(540),n=o(215),i=o(307),a=o(848);const s=(0,r.createContext)(null);function l(e){let{children:t,initialData:o,widgetMode:l=!1}=e;const[c,d]=(0,r.useState)({}),[u,p]=(0,r.useState)({}),[f,m]=(0,r.useState)([]),[g,h]=(0,r.useState)([]),[b]=(0,r.useState)((()=>{if("undefined"==typeof window)return"server-side";const e="true"===new URLSearchParams(window.location.search).get("new_session");let t=localStorage.getItem("card_session_id");return t&&!e||(t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("card_session_id",t),console.log(`🆕 ${e?"Forced":"Generated"} new session: ${t}`)),t})()),y=(0,r.useCallback)(async(e,t)=>{console.log(`🔄 updateField called: fieldName="${e}", value="${t}", sessionId="${b}"`);const o={...c,[e]:t};d(o),console.log(`Updated formData for ${e}:`,o),l||(0,i.updateSessionWithFormData)(b,o);const r=f.find(t=>t.card_fields?.some(t=>t.field_name===e));if(r){console.log(`🗃️ Updating field completion in database for card "${r.name}"`);let i=!1;if(l){const e=r.card_fields||[],t=e.filter(e=>e.required);i=t.length>0?t.every(e=>o[e.field_name]&&""!==o[e.field_name]):e.some(e=>o[e.field_name]&&""!==o[e.field_name]),console.log(`📋 Card "${r.name}" local completion check: ${i}`,{requiredFields:t.length,totalFields:e.length,filledFields:e.filter(e=>o[e.field_name]).length,formData:o})}else await(0,n.updateFieldCompletion)(r.id,e,t,b),i=await(0,n.checkCardCompletion)(r.id,b),console.log(`📋 Card "${r.name}" database completion check (session-isolated): ${i}`),i&&await(0,n.updateCardCompletion)(r.id,b,!0,e);i&&(p(e=>({...e,[r.id]:{...e[r.id],status:"complete"}})),await S(r))}},[f,b,c,l]),x=((0,r.useCallback)(e=>{p(t=>({...t,[e]:{...t[e],status:"unlocked"}}))},[]),(0,r.useCallback)(e=>{p(t=>({...t,[e]:{...t[e],status:"unlocked"}}))},[])),v=(0,r.useCallback)(e=>{const t=f.find(t=>t.id===e);console.log(`🎯 REVEAL: Granting reveal permission to Card "${t?.name}" (${e})`),p(t=>({...t,[e]:{...t[e],isRevealed:!0}}))},[f]),S=(0,r.useCallback)(async e=>{console.log(`✅ Card "${e.name}" completed, checking reveal timing for next card`);const t=f.findIndex(t=>t.id===e.id),o=f[t+1];if(o){const t=e.reveal_timing;if(console.log("🕐 Reveal timing settings:",{reveal_timing:t,nextCard:o.name}),t){if("immediately"===t.timing)console.log(`⚡ Granting immediate reveal permission to "${o.name}"`),v(o.id);else if("after_delay"===t.timing){const e=1e3*(t.delay_seconds||3);console.log(`⏱️ Will grant reveal permission to "${o.name}" after ${e}ms`),setTimeout(()=>{console.log(`⚡ Granting delayed reveal permission to "${o.name}"`),v(o.id)},e)}}else console.warn(`Card "${e.name}" has no reveal_timing defined. Please set reveal_timing in admin.`),v(o.id)}},[f,v]),w=(0,r.useCallback)(e=>{switch(e.type){case"info":case"visual":case"calculation":return!0;case"form":{const t=e.card_fields||[];if(0===t.length)return!0;const o=e.completion_rules;if(!o?.form_completion)return console.warn(`Form card "${e.name}" has no completion_rules defined. Please set completion_rules in admin.`),!1;{const r=o.form_completion;switch(r.type){case"any_field":return t.some(e=>{const t=c[e.field_name];return null!=t&&""!==t});case"all_fields":const o=t.every(e=>{const t=c[e.field_name],o=null!=t&&""!==t;return console.log(`🔍 Field completion check: ${e.field_name} (${e.field_type}) = "${t}" -> ${o?"COMPLETE":"INCOMPLETE"}`),o});return console.log(`🎯 Card "${e.name}" all_fields completion result: ${o} (${t.length} fields total)`),o;case"required_fields":const n=r.required_field_names||[];if(0===n.length){const e=t.filter(e=>e.required);return 0===e.length?t.some(e=>{const t=c[e.field_name];return null!=t&&""!==t}):e.every(e=>{const t=c[e.field_name];return null!=t&&""!==t})}return n.every(e=>{const t=c[e];return null!=t&&""!==t});default:return!1}}}case"submit":return"complete"===u[e.id]?.status;default:return!1}},[c,u]),k=(0,r.useCallback)(async e=>{if(l){console.log("📧 Widget mode: Submitting via WordPress AJAX",{formData:c,emailTemplate:e});try{const t=window.e1_widget_config;if(!t?.nonce)throw console.error("❌ WordPress nonce not found"),new Error("WordPress configuration not found");const o=Object.entries(u).filter(e=>{let[t,o]=e;return o.data&&Object.keys(o.data).length>0}).reduce((e,t)=>{let[o,r]=t;return{...e,[o]:r.data}},{}),r=await fetch(t.ajax_url||"/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"e1_submit_form",nonce:t.nonce,formData:JSON.stringify(c),calculations:JSON.stringify(o),emailTemplate:e||""})});if(!r.ok)throw new Error("WordPress submission failed");const n=await r.json();if(!n.success)throw new Error(n.data||"Submission failed");return console.log("✅ Widget form submitted successfully via WordPress"),n.data}catch(e){throw console.error("❌ Widget submission error:",e),e}}const t={...c,submit_email_template:e};if(!(await fetch("/api/submit-lead",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("Failed to submit form data")},[c,l]),_=(0,r.useCallback)(e=>{console.log(`completeCard called for: ${e}`);const t=f.find(t=>t.id===e);p(o=>{const r={...o};return r[e]={...r[e],status:"complete"},f.forEach(o=>{if(o.reveal_conditions&&o.reveal_conditions.length>0){if(o.reveal_conditions.every(t=>{if("card_complete"===t.type){return(t.target||[]).every(t=>{const o=f.find(e=>e.name===t);return!!o&&(o.id===e||"complete"===r[o.id]?.status)})}return!0})&&!r[o.id]?.isRevealed){console.log(`✅ Revealing card "${o.name}" - conditions met after completing "${t?.name}"`),r[o.id]={...r[o.id],isRevealed:!0};Object.entries(r).find(e=>{let[t,o]=e;return"active"===o.status})||(r[o.id].status="active")}}}),console.log("Updated card states after completion:",r),r});const o=f.findIndex(t=>t.id===e),r=f[o+1];if(r){const e=f[o],t=e.reveal_timing;if(console.log(`Card ${e.name} completed, checking reveal timing for next card ${r.name}:`,{reveal_timing:t}),t){if("immediately"===t.timing)console.log(`Granting immediate reveal permission to ${r.name}`),v(r.id);else if("after_delay"===t.timing){const e=1e3*(t.delay_seconds||3);console.log(`Will grant reveal permission to ${r.name} after ${e}ms`),setTimeout(()=>{console.log(`Granting delayed reveal permission to ${r.name}`),v(r.id)},e)}}else console.warn(`Card "${e.name}" has no reveal_timing defined. Please set reveal_timing in admin.`),v(r.id)}},[f,v]),j=(0,r.useCallback)(e=>{p(t=>{const o={...t};return Object.keys(o).forEach(e=>{"active"===o[e].status&&(o[e]={...o[e],status:"unlocked"})}),o[e]={...o[e],status:"active"},o})},[]),C=(0,r.useCallback)(async e=>{console.log("🚀 setCardsAndInitialize called with:",e),m(e);const t=e.map(e=>e.id);h(t);const o={};for(let r=0;r<t.length;r++){const i=t[r],a=e.find(e=>e.id===i);if(0===r)o[i]={status:"active",isRevealed:!0},console.log(`🟢 INIT: Card ${r} "${a?.name}" set to ACTIVE and REVEALED`);else{let e=!1;if(!l){const t=await(0,n.getCardCompletion)();e=t?.is_complete||!1}o[i]={status:e?"complete":"hidden",isRevealed:!1},console.log(`🔴 INIT: Card ${r} "${a?.name}" set to ${e?"COMPLETE":"HIDDEN"} and NOT REVEALED`)}}p(o)},[b]),E=(0,r.useCallback)(e=>!e.reveal_conditions||0===e.reveal_conditions.length||e.reveal_conditions.every(e=>{if("card_complete"===e.type){return(e.target||[]).every(e=>{const t=f.find(t=>t.name===e);if(!t)return console.warn(`Reveal condition references non-existent card: ${e}`),!0;if("info"===t.type)return!0;const o=t.card_fields||[];return 0===o.length||o.some(e=>{const t=c[e.field_name];return null!=t&&""!==t})})}return!0}),[c,f]),$=(0,r.useCallback)(function(e){if((arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set).has(e.id))return console.warn(`Circular dependency detected for card: ${e.name}`),!1;const t=u[e.id];if(!0===t?.isRevealed)return!0;if(!1===t?.isRevealed)return!1;const o=f.findIndex(t=>t.id===e.id);return o<=0&&(console.log(`First card (${o<=0}), always revealed`),!0)},[u,f]);(0,r.useEffect)(()=>{console.log("🔥 CardContext useEffect is running!");(async()=>{console.log("🚀 CardContext: Starting to load cards...");try{let e;o?.cards?(console.log("📦 Using offline data from config.json"),e=o.cards):"undefined"!=typeof window&&window.__E1_WIDGET_DATA?.cards?(console.log("📦 Using widget data from global store"),e=window.__E1_WIDGET_DATA.cards):l?(console.warn("⚠️ Widget mode enabled but no data provided. Cards will be empty."),e=[]):(console.log("📞 CardContext: Calling getCardsDirect()..."),e=await(0,n.getCardsDirect)()),console.log("✅ CardContext: Cards loaded successfully:",e.length,"cards"),console.log("📋 CardContext: Card details:",e.map(e=>({id:e.id,name:e.name,hasVisualObjects:!!e.visual_objects}))),console.log("🚀 setCardsAndInitialize called with:",e),m(e);const t=e.map(e=>e.id);h(t);const r={};for(let o=0;o<t.length;o++){const n=t[o],i=e.find(e=>e.id===n);0===o?(r[n]={status:"active",isRevealed:!0},console.log(`🟢 INIT: Card ${o} "${i?.name}" set to ACTIVE and REVEALED`)):(r[n]={status:"hidden",isRevealed:!1},console.log(`🔴 INIT: Card ${o} "${i?.name}" set to HIDDEN and NOT REVEALED`))}p(r)}catch(e){console.error("❌ CardContext: Failed to load cards:",e),e instanceof Error&&console.error("Stack trace:",e.stack)}})()},[o,l]),(0,r.useEffect)(()=>{if(l)return void console.log("🌐 Widget mode: Skipping session initialization");(async()=>{if(l)console.log("🔧 Widget mode: Skipping session initialization");else{console.log("🧹 Cleaning session data for fresh start...");try{await(0,n.initializeCleanSession)(b),localStorage.removeItem("session_needs_cleanup"),console.log("✅ Session cleaned and initialized successfully")}catch(e){console.error("❌ Failed to clean session:",e)}}})()},[b,l]);const O={formData:c,cardStates:u,cards:f,sessionId:b,updateField:y,completeCard:_,uncompleteCard:x,activateCard:j,setCardsAndInitialize:C,checkRevealConditions:E,shouldBeRevealed:$,revealCard:v,isCardComplete:w,submitData:k};return console.log("🎯 CardContext providing value:",{cards:O.cards?.length||0,hasCards:!!O.cards&&O.cards.length>0,cardStatesCount:Object.keys(O.cardStates||{}).length,formDataKeys:Object.keys(O.formData||{}).length,widgetMode:l}),(0,a.jsx)(s.Provider,{value:O,children:t})}const c=()=>{const e=(0,r.useContext)(s);if(!e)throw new Error("useCardContext must be used within CardProvider");return e};var d=JSON.parse('{"x":{"version":"1.0.0","theme":"minimal","lastModified":"2024-01-15","container":{"_comment":"Main wrapper for the entire card system","width":"100%","maxWidth":"1000px","minHeight":"600px","height":"auto","margin":"0 auto","padding":"0","background":"transparent","borderRadius":"12px","border":"none","boxShadow":"0 10px 40px rgba(0, 0, 0, 0.1)","overflow":"hidden"},"layout":{"_comment":"Layout proportions and spacing","visualSupportRatio":"60%","cardStreamRatio":"40%","gapBetweenPanels":"0","verticalSpacing":"default","display":"flex","flexDirection":"row","alignItems":"stretch"},"visualSupport":{"_comment":"Left panel configuration","enabled":true,"minWidth":"400px","background":"#ffffff","borderRight":"1px solid #e5e7eb","padding":"0","position":"sticky","top":"0","height":"100vh","maxHeight":"800px","sticky":{"enabled":true,"top":"0","height":"100vh","transform":"translate3d(0, 0, 0)","willChange":"transform","backfaceVisibility":"hidden"},"content":{"background":"linear-gradient(135deg, #059669 0%, #34d399 100%)","padding":"0","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center","flex":"1","minHeight":"500px"},"title":{"fontSize":"28px","fontWeight":"300","color":"#ffffff","marginBottom":"12px","textAlign":"center","letterSpacing":"-0.02em"},"subtitle":{"fontSize":"16px","fontWeight":"400","color":"rgba(255, 255, 255, 0.9)","textAlign":"center","lineHeight":"1.5"},"icon":{"fontSize":"100px","marginBottom":"20px","animation":"float 3s ease-in-out infinite","opacity":"1"},"image":{"aspectRatio":"16/9","borderRadius":"0","objectFit":"cover","width":"100%","height":"100%","maxWidth":"100%","maxHeight":"500px","lazyLoading":true,"fallbackColor":"#f3f4f6","overlay":{"enabled":true,"position":"bottom","spacing":"20px","background":"rgba(0, 0, 0, 0.7)","padding":"12px 16px","borderRadius":"8px","backdropFilter":"blur(4px)","textAlign":"center","titleColor":"#ffffff"}},"infoSection":{"background":"#ffffff","padding":"24px","borderTop":"1px solid #e5e7eb","title":{"fontSize":"22px","fontWeight":"300","color":"#1f2937","marginBottom":"8px"},"description":{"fontSize":"14px","fontWeight":"400","color":"#6b7280","lineHeight":"1.5","maxLines":"4"},"tip":{"marginTop":"16px","padding":"12px","background":"#ecfdf5","borderLeft":"4px solid #10b981","borderRadius":"4px","fontSize":"13px","color":"#047857","display":"block"}},"mobile":{"behavior":"hide","breakpoint":"768px","collapseMode":"hidden","drawerBehavior":"disabled","touchGestures":false,"overlayOptions":{"enabled":false,"background":"rgba(0, 0, 0, 0.5)","closeOnClick":true}}},"cardStream":{"_comment":"Right panel containing cards","width":"55%","background":"#f7f8f9","padding":"30px","paddingBottom":"100px","overflowY":"auto","overflowX":"hidden","maxHeight":"100vh","scrollBehavior":"auto","contentWrapper":{"maxWidth":"600px","margin":"0 auto","width":"100%"},"cardSpacing":"20px","firstCardMarginTop":"0","lastCardMarginBottom":"40px"},"card":{"_comment":"Individual card styling","base":{"background":"#ffffff","borderRadius":"12px","border":"1px solid #e5e7eb","padding":"32px","marginBottom":"20px","boxShadow":"0 1px 3px rgba(0, 0, 0, 0.04)","transition":"all 200ms cubic-bezier(0.4, 0, 0.2, 1)","cursor":"default","position":"relative","overflow":"hidden"},"hover":{"boxShadow":"0 4px 12px rgba(0, 0, 0, 0.08)","transform":"translateY(-2px)"},"states":{"locked":{"opacity":"0.6","filter":"blur(8px)","pointerEvents":"none","transform":"scale(0.98)","transition":"all 500ms ease"},"active":{"border":"2px solid rgba(16, 185, 129, 0.5)","boxShadow":"0 0 0 3px rgba(16, 185, 129, 0.1)","transform":"scale(1.01)","background":"#ffffff"},"complete":{"borderLeft":"4px solid #10b981","opacity":"1","background":"#ffffff","checkmark":{"enabled":true,"position":"absolute","top":"16px","right":"16px","size":"24px","color":"#10b981","background":"rgba(16, 185, 129, 0.1)","borderRadius":"50%","padding":"4px"}},"unlocking":{"animation":"slideUp 500ms ease-out"}},"header":{"display":"flex","justifyContent":"space-between","alignItems":"center","marginBottom":"24px","gap":"16px","borderBottom":"1px solid #d9d9d9","paddingBottom":"20px"},"stepIndicator":{"fontSize":"12px","fontWeight":"600","color":"#10b981","textTransform":"uppercase","letterSpacing":"1px","padding":"0","marginBottom":"8px","display":"block"},"badge":{"display":"inline-block","padding":"4px 12px","background":"rgba(16, 185, 129, 0.1)","color":"#10b981","borderRadius":"100px","fontSize":"11px","fontWeight":"500","textTransform":"uppercase","letterSpacing":"0.5px"},"title":{"fontSize":"24px","fontWeight":"300","color":"#1f2937","lineHeight":"1.2","marginBottom":"8px","letterSpacing":"0"},"description":{"fontSize":"14px","fontWeight":"400","color":"#6b7280","lineHeight":"1.5","marginBottom":"24px","maxWidth":"100%"}},"formElements":{"_comment":"Form field styling - Minimal theme specific","formGroup":{"marginBottom":"20px","width":"100%"},"fieldRow":{"display":"grid","gridTemplateColumns":"1fr 1fr","gap":"16px","marginBottom":"20px"},"label":{"display":"block","fontSize":"11px","fontWeight":"500","color":"#9ca3af","textTransform":"uppercase","letterSpacing":"0.5px","marginBottom":"8px","transition":"color 200ms ease"},"input":{"width":"100%","padding":"8px 0","fontSize":"14px","fontWeight":"400","color":"#1f2937","background":"transparent","border":"none","borderBottomWidth":"2px","borderBottomStyle":"solid","borderBottomColor":"#e5e7eb","borderRadius":"0","outline":"none","transition":"border-color 200ms ease","appearance":"none","placeholder":{"color":"#d1d5db","fontWeight":"400"},"hover":{"borderBottomColor":"#d1d5db"},"focus":{"borderBottomColor":"#10b981","boxShadow":"none"},"error":{"borderBottomColor":"#ef4444"},"disabled":{"opacity":"0.5","cursor":"not-allowed","borderBottomColor":"#f3f4f6"}},"select":{"_extends":"input","paddingRight":"32px","backgroundImage":"url(\\"data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 20 20\'%3e%3cpath stroke=\'%239ca3af\' stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'1.5\' d=\'M6 8l4 4 4-4\'/%3e%3c/svg%3e\\")","backgroundPosition":"right 0 center","backgroundRepeat":"no-repeat","backgroundSize":"20px","cursor":"pointer"},"errorMessage":{"fontSize":"12px","color":"#ef4444","marginTop":"4px","display":"block"},"buttons":{"_comment":"Button field type - selection buttons for forms with vertical layout","container":{"display":"flex","flexDirection":"column","gap":"12px","marginTop":"0"},"button":{"padding":"16px 20px","fontSize":"14px","fontWeight":"400","color":"#4b5563","background":"#ffffff","borderWidth":"2px","borderStyle":"solid","borderColor":"#e5e7eb","borderRadius":"8px","cursor":"pointer","transition":"all 200ms ease","textAlign":"left","width":"100%","display":"flex","alignItems":"center","justifyContent":"space-between","minHeight":"56px","position":"relative"},"buttonHover":{"borderColor":"#d1d5db","background":"#f9fafb","transform":"translateY(-1px)","boxShadow":"0 2px 4px rgba(0, 0, 0, 0.05)"},"buttonSelected":{"borderColor":"#10b981","background":"linear-gradient(135deg, #ecfdf5, #ffffff)","color":"#065f46","fontWeight":"500","boxShadow":"0 0 0 3px rgba(16, 185, 129, 0.1)"},"buttonDisabled":{"opacity":"0.5","cursor":"not-allowed","borderColor":"#f3f4f6","background":"#f9fafb"},"buttonFocus":{"outline":"3px solid #10b981","outlineOffset":"2px"},"buttonContent":{"display":"flex","alignItems":"center","flex":"1"},"buttonIcon":{"marginRight":"12px","fontSize":"20px","color":"#6b7280","flexShrink":"0","transition":"color 200ms ease"},"buttonIconSelected":{"color":"#10b981"},"buttonText":{"flex":"1","textAlign":"left"},"buttonTitle":{"fontSize":"15px","fontWeight":"500","color":"#1f2937","marginBottom":"2px","lineHeight":"1.2"},"buttonSubtitle":{"fontSize":"13px","fontWeight":"400","color":"#6b7280","lineHeight":"1.3"},"buttonIndicator":{"marginLeft":"12px","fontSize":"16px","color":"#d1d5db","transition":"all 200ms ease","flexShrink":"0"},"buttonIndicatorSelected":{"color":"#10b981","transform":"scale(1.1)"},"multiSelect":{"_comment":"Multi-selection checkbox styling","checkbox":{"marginRight":"12px","width":"18px","height":"18px","accentColor":"#10b981","borderRadius":"4px","borderWidth":"2px","borderStyle":"solid","borderColor":"#d1d5db","transition":"all 200ms ease"},"checkboxChecked":{"backgroundColor":"#10b981","borderColor":"#10b981","backgroundImage":"url(\\"data:image/svg+xml,%3csvg viewBox=\'0 0 16 16\' fill=\'white\' xmlns=\'http://www.w3.org/2000/svg\'%3e%3cpath d=\'m13.854 3.646-7.5 7.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6 10.293l7.146-7.147a.5.5 0 0 1 .708.708z\'/%3e%3c/svg%3e\\")"}},"animations":{"buttonHover":{"duration":"200ms","easing":"cubic-bezier(0.4, 0, 0.2, 1)"},"selection":{"duration":"300ms","easing":"cubic-bezier(0.34, 1.56, 0.64, 1)","scaleEffect":"1.02"},"stagger":{"enabled":true,"delay":"50ms","direction":"top-to-bottom"}}}},"calculationCard":{"_comment":"Display Template in Card Builder settings","container":{"background":"linear-gradient(135deg, #ecfdf5, #ffffff)","borderRadius":"12px","padding":"32px","marginBottom":"20px","boxShadow":"0 1px 3px rgba(0, 0, 0, 0.04)","transition":"all 200ms cubic-bezier(0.4, 0, 0.2, 1)","position":"relative","overflow":"hidden"},"header":{"marginBottom":"24px","borderBottom":"1px solid #d9d9d9","paddingBottom":"20px"},"title":{"fontSize":"24px","fontWeight":"300","color":"#1f2937","lineHeight":"1.2","marginBottom":"8px","letterSpacing":"0"},"description":{"fontSize":"14px","fontWeight":"400","color":"#6b7280","lineHeight":"1.5","marginBottom":"0"},"resultSection":{"display":"flex","alignItems":"flex-end","justifyContent":"space-between","marginBottom":"24px","gap":"16px"},"resultDisplay":{"flex":"1"},"metricLabel":{"fontSize":"11px","fontWeight":"500","color":"#9ca3af","textTransform":"uppercase","letterSpacing":"0.5px","marginBottom":"12px","display":"block"},"metricValue":{"fontSize":"48px","fontWeight":"200","color":"#10b981","lineHeight":"1.1","marginBottom":"0","display":"inline-block"},"metricUnit":{"fontSize":"18px","fontWeight":"300","color":"#6b7280","marginLeft":"8px","display":"inline-block"},"editButton":{"padding":"6px 8px","fontSize":"12px","fontWeight":"400","color":"#6b7280","background":"transparent","borderWidth":"1px","borderStyle":"solid","borderColor":"#e5e7eb","borderRadius":"6px","cursor":"pointer","transition":"all 200ms ease","display":"flex","alignItems":"center","gap":"4px","flexShrink":"0","height":"28px"},"editButtonHover":{"borderColor":"#d1d5db","background":"#f9fafb","color":"#4b5563"},"editButtonFocus":{"outline":"2px solid #10b981","outlineOffset":"1px"},"editIcon":{"fontSize":"14px","color":"inherit"},"editMode":{"_comment":"Styles when in edit mode - mobile-first stacked layout","container":{"borderLeft":"4px solid #f59e0b","background":"linear-gradient(135deg, #fef3c7, #ffffff)"},"inputGroup":{"display":"flex","flexDirection":"column","gap":"16px","marginBottom":"24px","alignItems":"stretch"},"inputWrapper":{"flex":"1","width":"100%","display":"flex","alignItems":"stretch","position":"relative","borderWidth":"2px","borderStyle":"solid","borderColor":"#e5e7eb","borderRadius":"8px","background":"#ffffff","overflow":"hidden","transition":"border-color 200ms ease"},"inputWrapperFocus":{"borderColor":"#10b981","boxShadow":"0 0 0 3px rgba(16, 185, 129, 0.1)"},"input":{"width":"100%","padding":"12px 16px","paddingRight":"80px","fontSize":"24px","fontWeight":"300","color":"#1f2937","background":"transparent","border":"none","outline":"none","textAlign":"center"},"inputFocus":{"borderColor":"#10b981","boxShadow":"0 0 0 3px rgba(16, 185, 129, 0.1)"},"inputError":{"borderColor":"#ef4444","boxShadow":"0 0 0 3px rgba(239, 68, 68, 0.1)"},"unitLabel":{"position":"absolute","right":"0","top":"0","bottom":"0","padding":"12px 16px","fontSize":"18px","fontWeight":"300","color":"#6b7280","background":"#f9fafb","borderLeft":"1px solid #e5e7eb","display":"flex","alignItems":"center","pointerEvents":"none"},"actionButtons":{"display":"flex","gap":"12px","alignItems":"center","justifyContent":"center","width":"100%"},"saveButton":{"padding":"10px 24px","fontSize":"14px","fontWeight":"500","color":"#ffffff","background":"#10b981","border":"none","borderRadius":"6px","cursor":"pointer","transition":"all 200ms ease","textTransform":"uppercase","letterSpacing":"0.5px","minWidth":"100px"},"saveButtonHover":{"background":"#059669","transform":"translateY(-1px)","boxShadow":"0 2px 4px rgba(16, 185, 129, 0.2)"},"saveButtonDisabled":{"opacity":"0.5","cursor":"not-allowed","background":"#9ca3af"},"cancelButton":{"padding":"10px 24px","fontSize":"14px","fontWeight":"400","color":"#6b7280","background":"transparent","borderWidth":"1px","borderStyle":"solid","borderColor":"#e5e7eb","borderRadius":"6px","cursor":"pointer","transition":"all 200ms ease","textTransform":"uppercase","letterSpacing":"0.5px","minWidth":"100px"},"cancelButtonHover":{"borderColor":"#d1d5db","background":"#f9fafb"}},"editedIndicator":{"_comment":"Shows when value has been manually edited","badge":{"position":"absolute","top":"16px","right":"16px","padding":"4px 8px","fontSize":"10px","fontWeight":"500","color":"#f59e0b","background":"#fef3c7","borderWidth":"1px","borderStyle":"solid","borderColor":"#fde68a","borderRadius":"12px","textTransform":"uppercase","letterSpacing":"0.5px","display":"flex","alignItems":"center","gap":"4px"},"icon":{"fontSize":"12px","color":"#f59e0b"}},"errorMessage":{"marginTop":"8px","padding":"8px 12px","background":"#fef2f2","borderLeft":"3px solid #ef4444","borderRadius":"4px","fontSize":"12px","color":"#b91c1c"},"breakdown":{"_comment":"Optional calculation breakdown section","marginTop":"24px","paddingTop":"20px","borderTop":"1px solid #f3f4f6","item":{"display":"flex","justifyContent":"space-between","alignItems":"center","padding":"8px 0","borderBottom":"1px solid #f9fafb"},"itemLast":{"borderBottom":"none"},"label":{"fontSize":"13px","color":"#6b7280","fontWeight":"400"},"value":{"fontSize":"14px","fontWeight":"500","color":"#1f2937"},"highlight":{"color":"#10b981","fontWeight":"600"}},"responsive":{"mobile":{"_comment":"Mobile styles for screens ≤768px","container":{"padding":"24px"},"metricValue":{"fontSize":"36px"},"metricUnit":{"fontSize":"16px"},"resultSection":{"flexDirection":"column","alignItems":"flex-start","gap":"12px"},"editButton":{"alignSelf":"flex-end"},"editMode":{"inputGroup":{"flexDirection":"column","alignItems":"stretch","gap":"16px"},"inputWrapper":{"maxWidth":"none"},"actionButtons":{"width":"100%","justifyContent":"stretch"},"saveButton":{"flex":"1"},"cancelButton":{"flex":"1"}}}}},"infoCard":{"_comment":"Information/notification card styling","background":"#f3f4f6","borderLeftColor":"#6b7280","icon":{"fontSize":"24px","color":"#10b981","marginBottom":"12px"},"content":{"fontSize":"14px","color":"#4b5563","lineHeight":"1.6"},"list":{"gap":"16px","marginTop":"16px"},"listItem":{"display":"grid","gridTemplateColumns":"24px 1fr","gap":"12px"}},"actionCard":{"_comment":"CTA/Submit button card styling","textAlign":"center","padding":"40px 32px","button":{"width":"100%","padding":"14px 28px","fontSize":"14px","fontWeight":"500","color":"#10b981","background":"transparent","border":"none","borderBottom":"2px solid #10b981","borderRadius":"0","textTransform":"uppercase","letterSpacing":"0.5px","cursor":"pointer","transition":"all 200ms ease","hover":{"background":"#10b981","color":"#ffffff","transform":"translateY(-1px)"},"active":{"transform":"translateY(0)"},"disabled":{"opacity":"0.5","cursor":"not-allowed","pointerEvents":"none"}}},"submitButton":{"_comment":"Submit button styling for form submissions","wrapper":{"marginTop":"40px","paddingTop":"32px","borderTop":"1px solid #f3f4f6"},"button":{"width":"100%","padding":"18px 32px","fontSize":"16px","fontWeight":"500","color":"#ffffff","background":"#10b981","border":"none","borderRadius":"8px","textTransform":"uppercase","letterSpacing":"1px","cursor":"pointer","transition":"all 300ms cubic-bezier(0.4, 0, 0.2, 1)","position":"relative","overflow":"hidden"},"buttonHover":{"background":"#059669","transform":"translateY(-2px)","boxShadow":"0 8px 20px rgba(16, 185, 129, 0.3)"},"buttonActive":{"transform":"translateY(0)","boxShadow":"0 4px 12px rgba(16, 185, 129, 0.2)"},"buttonDisabled":{"opacity":"0.5","cursor":"not-allowed","background":"#9ca3af","transform":"none","pointerEvents":"none"},"buttonLoading":{"_comment":"Loading state with spinner","spinner":{"display":"inline-block","width":"14px","height":"14px","borderWidth":"2px","borderStyle":"solid","borderColor":"#ffffff","borderRadius":"50%","borderTopColor":"transparent","animation":"spin 1s linear infinite","marginLeft":"8px"}},"buttonSuccess":{"_comment":"Success state after submission","background":"#10b981","icon":"✓","text":"Onnistui!"},"rippleEffect":{"_comment":"Ripple animation on click","enabled":true,"color":"rgba(255, 255, 255, 0.2)","duration":"600ms","size":"300px"},"alternativeStyle":{"_comment":"Alternative minimal style with bottom border only","width":"100%","padding":"14px 28px","fontSize":"14px","fontWeight":"500","color":"#10b981","background":"transparent","border":"none","borderBottom":"2px solid #10b981","borderRadius":"0","textTransform":"uppercase","letterSpacing":"0.5px","cursor":"pointer","transition":"all 200ms ease","hover":{"background":"#10b981","color":"#ffffff","transform":"translateY(-1px)"},"active":{"transform":"translateY(0)"}},"responsive":{"_comment":"Mobile responsive adjustments","mobile":{"wrapper":{"marginTop":"32px","paddingTop":"24px"},"button":{"padding":"16px 24px","fontSize":"14px","letterSpacing":"0.5px"}}}},"responsive":{"_comment":"Responsive breakpoints and behavior","breakpoints":{"mobile":"768px","tablet":"1024px","desktop":"1280px"},"mobile":{"_comment":"Settings for screens ≤768px","layout":{"flexDirection":"column","gap":"0"},"visualSupport":{"display":"none","width":"100%","height":"auto","position":"relative"},"cardStream":{"width":"100%","padding":"20px","maxHeight":"none"},"card":{"padding":"24px","borderRadius":"8px","marginBottom":"16px"},"title":{"fontSize":"20px"},"metricValue":{"fontSize":"36px"},"fieldRow":{"gridTemplateColumns":"1fr","gap":"0"}},"tablet":{"_comment":"Settings for screens 768px-1024px","visualSupport":{"width":"40%"},"cardStream":{"width":"60%"}}},"animations":{"_comment":"Animation configurations","cardReveal":{"enabled":true,"duration":"500ms","easing":"cubic-bezier(0.4, 0, 0.2, 1)","keyframes":"slideUp","from":{"opacity":"0","transform":"translateY(40px)"},"to":{"opacity":"1","transform":"translateY(0)"}},"transitions":{"fast":"150ms","default":"200ms","slow":"300ms","slower":"500ms"},"hover":{"lift":"-2px","scale":"1.02","shadowIncrease":true},"float":{"enabled":true,"duration":"3s","distance":"20px"}},"colors":{"_comment":"Global color palette - Minimal theme","brand":{"primary":"#10b981","primaryHover":"#059669","primaryLight":"#ecfdf5"},"text":{"primary":"#1f2937","secondary":"#6b7280","tertiary":"#9ca3af","placeholder":"#d1d5db","inverse":"#ffffff"},"background":{"primary":"#ffffff","secondary":"#f7f8f9","tertiary":"#f3f4f6","disabled":"#f9fafb"},"border":{"default":"#e5e7eb","hover":"#d1d5db","focus":"#10b981","subtle":"#f9fafb"},"state":{"error":"#ef4444","warning":"#f59e0b","success":"#10b981","info":"#3b82f6"}},"typography":{"_comment":"Global typography settings","fontFamily":"system-ui, -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, \'Helvetica Neue\', Arial, sans-serif","fontSizeBase":"14px","lineHeightBase":"1.5","fontWeightLight":"300","fontWeightNormal":"400","fontWeightMedium":"500","fontWeightSemibold":"600"},"features":{"_comment":"Feature flags and settings","progressiveDisclosure":true,"autoScroll":false,"smoothScrolling":false,"cardClickable":true,"showStepIndicators":true,"validateOnBlur":true,"validateOnSubmit":true,"showCalculationsRealtime":false,"allowBackNavigation":false,"persistData":false,"analytics":{"enabled":true,"trackInteractions":true,"trackCompletion":true}},"accessibility":{"_comment":"Accessibility settings","focusOutline":"3px solid #10b981","focusOutlineOffset":"2px","minContrastRatio":"4.5:1","minTouchTarget":"44px","keyboardNavigation":true,"screenReaderSupport":true,"reducedMotion":{"respectPreference":true,"disableAnimations":true},"ariaLabels":{"stepIndicator":"Step {current} of {total}","requiredField":"Required field","errorMessage":"Error: {message}","successMessage":"Success: {message}"}}}}');const u=d.x;function p(){return{colors:u.colors,card:u.card,formElements:u.formElements,calculationCard:u.calculationCard,infoCard:u.infoCard,actionCard:u.actionCard,submitButton:u.submitButton,typography:u.typography,animations:u.animations,container:u.container,layout:u.layout,visualSupport:u.visualSupport,cardStream:u.cardStream,responsive:u.responsive,accessibility:u.accessibility,features:u.features}}u.colors.brand.primary,u.colors.brand.primaryHover,u.colors.state.info,u.colors.state.error,u.colors.text.secondary,u.colors.text.tertiary,u.colors.text.placeholder,u.colors.text.primary,u.colors.background.tertiary,u.colors.border.default,u.card.title.fontSize,u.typography.fontSizeBase,u.formElements.errorMessage.fontSize,u.formElements.label.fontSize,u.calculationCard.metricValue.fontSize,u.typography.fontWeightSemibold,u.typography.fontWeightMedium,u.typography.fontWeightLight,u.typography.fontWeightNormal,u.card.base.padding,u.cardStream.cardSpacing,u.card.base.borderRadius,u.animations.transitions.default,u.animations.transitions.slower;function f(e){let{card:t,onFieldFocus:o,widgetMode:n=!1}=e;const i=p(),{formData:s,updateField:l,cardStates:d,submitData:u,completeCard:f,uncompleteCard:m}=c(),[g,h]=(0,r.useState)({}),[b,y]=(0,r.useState)(!1),[x,v]=(0,r.useState)(!1),[S,w]=(0,r.useState)(null),k=!1,_=e=>({display:i.formElements.label.display,fontSize:i.formElements.label.fontSize,fontWeight:i.formElements.label.fontWeight,color:S===e?i.colors.brand.primary:i.formElements.label.color,textTransform:i.formElements.label.textTransform,letterSpacing:i.formElements.label.letterSpacing,marginBottom:i.formElements.label.marginBottom,transition:i.formElements.label.transition}),j=(e,o)=>{l(e,o),g[e]&&h(t=>({...t,[e]:""}));const r=t.card_fields?.every(e=>"buttons"===e.field_type);if(r&&"complete"===d[t.id]?.status){const r=t.card_fields?.every(t=>{const r=t.field_name===e?o:s[t.field_name];return!r||Array.isArray(r)&&0===r.length});r&&m(t.id)}},C=e=>{w(e.field_name),o&&o(t.id,e.field_name,s[e.field_name])},E=e=>{w(null),e.required&&!s[e.field_name]&&h(t=>({...t,[e.field_name]:"This field is required"}))},$=e=>{const t=s[e.field_name]||"",o=g[e.field_name];switch(e.field_type){case"text":case"email":case"number":return(0,a.jsxs)("div",{style:{marginBottom:i.formElements.formGroup.marginBottom},children:[(0,a.jsxs)("label",{style:_(e.field_name),children:[e.label,e.required&&(0,a.jsx)("span",{style:{color:i.colors.state.error},children:"*"})]}),(0,a.jsx)("input",{type:e.field_type,value:t,onChange:t=>j(e.field_name,t.target.value),onFocus:()=>C(e),onBlur:()=>E(e),disabled:k,style:{...i.formElements.input,...S===e.field_name?i.formElements.input.focus:{},...o?i.formElements.input.error:{}}}),e.help_text&&(0,a.jsx)("p",{style:{fontSize:i.typography.fontSizeBase,color:i.colors.text.tertiary,marginTop:"4px"},children:e.help_text}),o&&(0,a.jsx)("p",{style:{fontSize:i.formElements.errorMessage.fontSize,color:i.formElements.errorMessage.color,marginTop:i.formElements.errorMessage.marginTop,display:i.formElements.errorMessage.display},children:o})]});case"select":return(0,a.jsxs)("div",{style:{marginBottom:i.formElements.formGroup.marginBottom},children:[(0,a.jsxs)("label",{style:_(e.field_name),children:[e.label,e.required&&(0,a.jsx)("span",{style:{color:i.colors.state.error},children:"*"})]}),(0,a.jsxs)("select",{value:t,onChange:t=>j(e.field_name,t.target.value),onFocus:()=>C(e),onBlur:()=>E(e),disabled:k,style:{...i.formElements.input,...i.formElements.select,...S===e.field_name?i.formElements.input.focus:{},...o?i.formElements.input.error:{}},children:[(0,a.jsx)("option",{value:"",children:"Select..."}),e.options?.map(e=>{const t="string"==typeof e?e:e.value,o="string"==typeof e?e:e.label;return(0,a.jsx)("option",{value:t,children:o},t)})]}),e.help_text&&(0,a.jsx)("p",{style:{fontSize:i.typography.fontSizeBase,color:i.colors.text.tertiary,marginTop:"4px"},children:e.help_text}),o&&(0,a.jsx)("p",{style:{fontSize:i.formElements.errorMessage.fontSize,color:i.formElements.errorMessage.color,marginTop:i.formElements.errorMessage.marginTop,display:i.formElements.errorMessage.display},children:o})]});case"radio":return(0,a.jsxs)("div",{style:{marginBottom:i.formElements.formGroup.marginBottom},children:[(0,a.jsx)("label",{style:_(e.field_name),children:e.label}),(0,a.jsx)("div",{style:{display:i.formElements.fieldRow.display,gridTemplateColumns:i.formElements.fieldRow.gridTemplateColumns,gap:i.formElements.fieldRow.gap,marginBottom:i.formElements.fieldRow.marginBottom,marginTop:"8px"},children:e.options?.map(o=>{const r="string"==typeof o?o:o.value,n="string"==typeof o?o:o.label;return(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"8px",opacity:1},children:(0,a.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:i.typography.fontSizeBase,color:i.colors.text.primary},children:[(0,a.jsx)("input",{type:"radio",name:e.field_name,value:r,checked:t===r,onChange:t=>j(e.field_name,t.target.value),onFocus:()=>C(e),onBlur:()=>E(e),disabled:k,style:{accentColor:i.colors.brand.primary}}),n]})},r)})}),e.help_text&&(0,a.jsx)("p",{style:{fontSize:i.typography.fontSizeBase,color:i.colors.text.tertiary,marginTop:"4px"},children:e.help_text}),o&&(0,a.jsx)("p",{style:{fontSize:i.formElements.errorMessage.fontSize,color:i.formElements.errorMessage.color,marginTop:i.formElements.errorMessage.marginTop,display:i.formElements.errorMessage.display},children:o})]});case"checkbox":return(0,a.jsxs)("div",{style:{marginBottom:i.formElements.formGroup.marginBottom},children:[(0,a.jsx)("div",{style:{display:"flex",gap:"8px",opacity:1},children:(0,a.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:i.typography.fontSizeBase,fontWeight:i.formElements.label.fontWeight,color:i.colors.text.primary},children:[(0,a.jsx)("input",{type:"checkbox",checked:Boolean(t),onChange:t=>j(e.field_name,t.target.checked),onFocus:()=>C(e),onBlur:()=>E(e),disabled:k,style:{accentColor:i.colors.brand.primary}}),e.label]})}),e.help_text&&(0,a.jsx)("p",{style:{fontSize:i.typography.fontSizeBase,color:i.colors.text.tertiary,marginTop:"4px"},children:e.help_text}),o&&(0,a.jsx)("p",{style:{fontSize:i.formElements.errorMessage.fontSize,color:i.formElements.errorMessage.color,marginTop:i.formElements.errorMessage.marginTop,display:i.formElements.errorMessage.display},children:o})]});case"textarea":return(0,a.jsxs)("div",{style:{marginBottom:i.formElements.formGroup.marginBottom},children:[(0,a.jsxs)("label",{style:_(e.field_name),children:[e.label,e.required&&(0,a.jsx)("span",{style:{color:i.colors.state.error},children:"*"})]}),(0,a.jsx)("textarea",{value:t,onChange:t=>j(e.field_name,t.target.value),onFocus:()=>C(e),onBlur:()=>E(e),disabled:k,style:{...i.formElements.input,...S===e.field_name?i.formElements.input.focus:{},...o?i.formElements.input.error:{},minHeight:"80px",resize:"vertical"}}),e.help_text&&(0,a.jsx)("p",{style:{fontSize:i.typography.fontSizeBase,color:i.colors.text.tertiary,marginTop:"4px"},children:e.help_text}),o&&(0,a.jsx)("p",{style:{fontSize:i.formElements.errorMessage.fontSize,color:i.formElements.errorMessage.color,marginTop:i.formElements.errorMessage.marginTop,display:i.formElements.errorMessage.display},children:o})]});case"buttons":const r=!1!==e.validation_rules?.selectOnlyOne,n=Array.isArray(t)?t:t?[t]:[];return(0,a.jsxs)("div",{style:{marginBottom:i.formElements.formGroup.marginBottom},children:[(0,a.jsxs)("label",{style:_(e.field_name),children:[e.label,e.required&&(0,a.jsx)("span",{style:{color:i.colors.state.error},children:"*"})]}),e.help_text&&(0,a.jsx)("p",{style:{fontSize:i.typography.fontSizeBase,color:i.colors.text.tertiary,marginTop:"4px",marginBottom:"8px"},children:e.help_text}),(0,a.jsx)("div",{style:i.formElements.buttons.container,children:e.options?.map(t=>{const o="string"==typeof t?t:t.value,s="string"==typeof t?t:t.label,l=n.includes(o);return(0,a.jsxs)("button",{type:"button",onClick:()=>{if(r)j(e.field_name,l?"":o);else{const t=l?n.filter(e=>e!==o):[...n,o];j(e.field_name,t)}},onFocus:t=>{C(e),Object.assign(t.currentTarget.style,i.formElements.buttons.buttonFocus)},onBlur:t=>{E(e),t.currentTarget.style.outline="none",t.currentTarget.style.outlineOffset="0"},disabled:k,style:{...i.formElements.buttons.button,...l?{...i.formElements.buttons.buttonSelected}:{}},onMouseEnter:e=>{l||Object.assign(e.currentTarget.style,i.formElements.buttons.buttonHover)},onMouseLeave:e=>{l||Object.assign(e.currentTarget.style,i.formElements.buttons.button)},children:[(0,a.jsxs)("span",{style:i.formElements.buttons.buttonContent,children:[!r&&(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:()=>{},style:{...i.formElements.buttons.multiSelect.checkbox,...l?i.formElements.buttons.multiSelect.checkboxChecked:{}},disabled:k,onClick:e=>e.stopPropagation()}),(0,a.jsx)("span",{style:i.formElements.buttons.buttonText,children:s})]}),l&&r&&(0,a.jsx)("span",{style:{...i.formElements.buttons.buttonIndicator,...i.formElements.buttons.buttonIndicatorSelected},children:"✓"})]},o)})}),o&&(0,a.jsx)("p",{style:{fontSize:i.formElements.errorMessage.fontSize,color:i.formElements.errorMessage.color,marginTop:i.formElements.errorMessage.marginTop,display:i.formElements.errorMessage.display},children:o})]});default:return(0,a.jsxs)("p",{children:["Unsupported field type: ",e.field_type]})}};return t.card_fields&&0!==t.card_fields.length?(0,a.jsxs)("div",{style:{padding:i.card.base.padding,position:i.card.base.position,overflow:i.card.base.overflow},children:[(0,a.jsx)("div",{style:i.card.header,children:(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("h2",{style:{fontSize:i.card.title.fontSize,fontWeight:i.card.title.fontWeight,color:i.card.title.color,lineHeight:i.card.title.lineHeight,marginBottom:i.card.title.marginBottom,letterSpacing:i.card.title.letterSpacing},children:t.title||t.name}),t.config?.description&&(0,a.jsx)("p",{style:{fontSize:i.card.description.fontSize,fontWeight:i.card.description.fontWeight,color:i.card.description.color,lineHeight:i.card.description.lineHeight,marginBottom:i.card.description.marginBottom},children:t.config.description})]})}),t.card_fields.sort((e,t)=>(e.display_order||0)-(t.display_order||0)).map(e=>(0,a.jsx)("div",{children:$(e)},e.field_name)),t.config?.has_submit_button&&(0,a.jsx)("div",{style:i.submitButton.wrapper,children:x?(0,a.jsxs)("div",{style:{textAlign:"center",padding:"20px",color:i.colors.state.success,fontSize:"16px",fontWeight:"500"},children:[(0,a.jsx)("span",{style:{fontSize:"24px",marginRight:"8px"},children:"✓"}),t.config?.submit_success_message||"Lomake lähetetty onnistuneesti!"]}):(0,a.jsx)("button",{onClick:async()=>{if(!b){y(!0);try{u&&await u(t.config?.submit_email_template),f(t.id),v(!0)}catch(e){console.error("Submission failed:",e)}finally{y(!1)}}},disabled:b,style:{...i.submitButton.button,...b?i.submitButton.buttonDisabled:{}},onMouseEnter:e=>{b||Object.assign(e.currentTarget.style,i.submitButton.buttonHover)},onMouseLeave:e=>{b||Object.assign(e.currentTarget.style,i.submitButton.button,{transform:"none",boxShadow:"none"})},onMouseDown:e=>{b||Object.assign(e.currentTarget.style,i.submitButton.buttonActive)},onMouseUp:e=>{b||Object.assign(e.currentTarget.style,i.submitButton.buttonHover)},children:b?(0,a.jsxs)(a.Fragment,{children:[t.config?.submit_button_text||"Lähetä",(0,a.jsx)("span",{style:{...i.submitButton.buttonLoading.spinner,display:"inline-block",marginLeft:"8px"}})]}):t.config?.submit_button_text||"Lähetä"})})]}):(0,a.jsx)("div",{style:{padding:"20px",color:i.colors.text.tertiary,fontSize:i.typography.fontSizeBase,textAlign:"center"},children:"No fields defined for this card"})}var m=o(221);class g{cache=(()=>new Map)();formulas=[];lookupTables=[];constructor(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const n={};for(const[e,t]of Object.entries(o))null==t?n[e]="":"object"==typeof t?void 0!==t.value?n[e]=t.value:n[e]=String(t):n[e]=t;this.context={sessionId:t,formData:n,maxDepth:10,batchSize:10},this.formulas=e||[],this.lookupTables=r||[]}clearCache(){console.log("🧹 Clearing WidgetCalculationEngine cache"),this.cache.clear()}async process(e){const t=performance.now();try{if(!e||"string"!=typeof e)return{success:!0,result:e||"",processedCount:0,executionTime:performance.now()-t,dependencies:[]};const o=this.extractDependencies(e),r=await this.extractFieldDependencies(e);let n;const i=e.match(/^\[calc:([^\]]+)\]$/),a=e.match(/^\[lookup:([^\]]+)\]$/);if(i){const e=i[1];console.log("Looking for formula:",e);const t=this.formulas.find(t=>t.name===e);console.log("Found formula:",t?.name,"with unit:",t?.unit),t&&t.unit&&(n=t.unit,console.log("Setting unit:",n))}else if(a){const e=a[1];console.log("Looking for lookup table:",e);const t=this.lookupTables.find(t=>t.name===e);if(t)if(e.includes("hinta"))n="€",console.log("Setting unit for price lookup:",n);else{const e=t.condition_field,o=this.context.formData[e],r=(t.lookup_values||[]).find(e=>e.condition_value===o);if(r&&r.return_value){const e=String(r.return_value).match(/^\[calc:([^\]]+)\]$/);if(e){const t=e[1],o=this.formulas.find(e=>e.name===t);o&&o.unit&&(n=o.unit,console.log(`Setting unit from nested calc ${t}:`,n))}}}}if(0===o.size)return{success:!0,result:e,unit:n,processedCount:0,executionTime:performance.now()-t,dependencies:r};const s=await this.resolveDependencies(o),l={success:!0,result:this.evaluateWithDependencies(e,s),unit:n,processedCount:o.size,executionTime:performance.now()-t,dependencies:r};return console.log("Returning from process:",l),l}catch(e){return{success:!1,error:`Processing failed: ${e instanceof Error?e.message:"Unknown error"}`,processedCount:0,executionTime:performance.now()-t,dependencies:[]}}}async extractFieldDependencies(e){const t=new Set,o=new Set;return await this._extractFieldDepsRecursive(e,t,o),Array.from(t)}async _extractFieldDepsRecursive(e,t,o){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(r>5)return;if(o.has(e))return;o.add(e);const n=/\{([a-z_][a-z0-9_]*)\}/gi;let i;for(;null!==(i=n.exec(e));)t.add(i[1]);const a=/\[calc:([^\]]+)\]/gi;for(;null!==(i=a.exec(e));){const e=i[1],n=this.formulas.find(t=>t.name===e),a=n?.formula_text||n?.formula;a&&await this._extractFieldDepsRecursive(a,t,o,r+1)}const s=/\[lookup:([^\]]+)\]/gi;for(;null!==(i=s.exec(e));){const e=i[1],o=this.lookupTables.find(t=>t.name===e);o&&o.condition_field&&(t.add(o.condition_field),console.log(`Added lookup condition field ${o.condition_field} as dependency for ${e}`))}}extractDependencies(e){const t=new Set,o=/\{([a-z_][a-z0-9_]*)\}/gi;let r;for(;null!==(r=o.exec(e));)t.add(`field:${r[1]}`);const n=/\[calc:([^\]]+)\]/gi;for(;null!==(r=n.exec(e));)t.add(`calc:${r[1]}`);const i=/\[lookup:([^\]]+)\]/gi;for(;null!==(r=i.exec(e));)t.add(`lookup:${r[1]}`);return t}async resolveDependencies(e){const t=new Map,o=Array.from(e),r=new Set;let n=0;for(;o.length>0&&n<this.context.maxDepth;){const e=o.splice(0,this.context.batchSize);for(const n of e){if(r.has(n))continue;r.add(n);const e=await this.resolveSingleDependency(n);t.set(n,e);const i=this.extractDependencies(e);for(const e of i)r.has(e)||o.push(e)}n++}return t}async resolveSingleDependency(e){if(this.cache.has(e))return this.cache.get(e).processed;const[t,o]=e.split(":",2);let r="";switch(t){case"field":r=String(this.context.formData[o]||"");break;case"calc":r=await this.processCalculation(o);break;case"lookup":r=await this.processLookup(o);break;default:r=e}return this.cache.set(e,{id:e,type:t,raw:e,processed:r,dependencies:[],timestamp:new Date}),r}async processCalculation(e){try{console.log(`Processing calculation: ${e}`),console.log("Available formulas:",this.formulas.map(e=>e.name));const t=this.formulas.find(t=>t.name===e);if(!t)return console.warn(`Formula not found: ${e}`),console.warn("Available formulas:",this.formulas.map(e=>e.name)),"0";if(!t.formula_text&&!t.formula)return console.warn(`Formula ${e} has no formula expression`),console.warn("Formula object keys:",Object.keys(t)),"0";let o=t.formula_text||t.formula;console.log(`Formula expression for ${e}:`,o),o=o.replace(/\[field:([^\]]+)\]/gi,"{$1}");const r=/\[calc:([^\]]+)\]/gi;let n;for(;null!==(n=r.exec(o));){const e=n[1],t=await this.processCalculation(e);o=o.replace(n[0],t)}const i=/\[lookup:([^\]]+)\]/gi;let a;for(;null!==(a=i.exec(o));){const e=a[1],t=await this.processLookup(e);o=o.replace(a[0],t)}o=o.replace(/\{([a-z_][a-z0-9_]*)\}/gi,(e,t)=>{const o=this.context.formData[t];return console.log(`  Replacing field ${t} with value: ${o}`),null==o||""===o?"0":String(o)}),console.log(`Final expression to evaluate: ${o}`);try{if(o.includes("[")||o.includes(":"))return console.error(`Expression still contains shortcodes: ${o}`),"0";const e=new Function("data",`\n          with(data) {\n            return (${o});\n          }\n        `)(this.context.formData);return"number"==typeof e?"currency"===t.output_format?new Intl.NumberFormat("fi-FI",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e):void 0!==t.decimal_places?e.toFixed(t.decimal_places):String(e):String(e)}catch(t){return console.error(`Error evaluating formula ${e}:`,t),"0"}}catch(t){return console.error(`Error processing calculation ${e}:`,t),"0"}}async processLookup(e){try{console.log(`Processing lookup: ${e}`),console.log("Available lookup tables:",this.lookupTables.map(e=>e.name));const t=this.lookupTables.find(t=>t.name===e);if(!t){console.warn(`Lookup table not found: ${e}`);const t=await(0,m.x3)(e,this.context.sessionId,this.context.formData);return t.success&&t.shortcode?t.shortcode:""}const o=t.condition_field,r=this.context.formData[o];console.log(`Lookup ${e}: checking ${o} = ${r}`);const n=t.lookup_values||[],i=n.find(e=>e.condition_value===r);if(i)return String(i.return_value||"0");const a=n.find(e=>"default"===e.condition_value||e.is_default);return a?String(a.return_value||"0"):"0"}catch(t){return console.error(`Error processing lookup ${e}:`,t),""}}evaluateWithDependencies(e,t){let o=e;for(const[e,r]of t){const[t,n]=e.split(":",2);switch(t){case"field":o=o.replace(new RegExp(`\\{${n}\\}`,"gi"),r);break;case"calc":o=o.replace(new RegExp(`\\[calc:${n}\\]`,"gi"),r);break;case"lookup":o=o.replace(new RegExp(`\\[lookup:${n}\\]`,"gi"),r)}}if(this.isExpression(o))try{const e=new Function("data",`\n          with(data) {\n            return (${o});\n          }\n        `)(this.context.formData);return String(e)}catch(e){return o}return o}isExpression(e){return/[\+\-\*\/\(\)]/.test(e)&&!/\[|\{/.test(e)}}const h=e=>{let{value:t,originalValue:o,unit:n,onUpdate:i,editButtonText:s="Syötä lukema",isCalculating:l=!1,editPrompt:c,validationMin:d,validationMax:u}=e;const f=p(),[m,g]=(0,r.useState)(!1),[h,b]=(0,r.useState)(""),[y,x]=(0,r.useState)(null),[v,S]=(0,r.useState)(!1),w=e=>{if(!e)return 0;const t=e.split(" ")[0];return parseFloat(t.replace(/\s/g,"").replace(",","."))||0};(0,r.useEffect)(()=>{const e=w(t),r=w(o);S(Math.abs(e-r)>.01)},[t,o]);const k=e=>e.toLocaleString("fi-FI"),_=()=>{const e=(e=>{const t=e.replace(/\s/g,"").replace(",","."),o=parseFloat(t);return isNaN(o)?null:o})(h);null!==e?void 0!==d&&e<d?x(`Arvon tulee olla vähintään ${k(d)}`):void 0!==u&&e>u?x(`Arvon tulee olla enintään ${k(u)}`):(i(e),g(!1),x(null)):x("Syötä kelvollinen numero")},j=()=>{g(!1),b(""),x(null)};if(l)return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:f.colors.state.info},children:[(0,a.jsx)("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:`2px solid ${f.colors.border.default}`,borderTopColor:f.colors.state.info,borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Lasketaan..."]});if(m)return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"},children:[(0,a.jsx)("input",{type:"text",value:h,onChange:e=>b(e.target.value),onKeyDown:e=>{"Enter"===e.key&&_(),"Escape"===e.key&&j()},style:{padding:f.formElements.input.padding,border:`1px solid ${y?f.colors.state.error:f.colors.border.default}`,borderRadius:f.formElements.input.borderRadius,fontSize:f.formElements.input.fontSize,flex:1},placeholder:"Syötä arvo",autoFocus:!0}),n&&(0,a.jsx)("span",{style:{color:f.colors.text.secondary,fontSize:f.typography.fontSizeBase,minWidth:"max-content"},children:n})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,a.jsx)("button",{onClick:_,style:{flex:1,padding:"0.625rem 1.5rem",background:f.colors.state.success,color:"#fff",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"✓ Tallenna"}),(0,a.jsx)("button",{onClick:j,style:{flex:1,padding:"0.625rem 1.5rem",background:f.colors.text.secondary,color:"#fff",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"✕ Peruuta"})]}),y&&(0,a.jsx)("div",{style:{color:f.colors.state.error,fontSize:f.formElements.errorMessage.fontSize,marginTop:"4px"},children:y})]});const C=t.split(" ")[0],E=n||t.split(" ").slice(1).join(" ");return(0,a.jsxs)("div",{style:{position:"relative"},children:[v&&(0,a.jsx)("div",{style:{position:"absolute",top:"-8px",right:"-8px",background:f.colors.state.warning,color:"white",fontSize:"0.75rem",padding:"2px 6px",borderRadius:"12px",fontWeight:f.typography.fontWeightMedium},children:"Muokattu"}),(0,a.jsx)("div",{style:f.calculationCard.resultDisplay,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,a.jsx)("div",{style:{...f.calculationCard.metricValue,flex:1},children:C}),E&&(0,a.jsx)("div",{style:f.calculationCard.metricUnit,children:E})]})}),(0,a.jsxs)("button",{onClick:()=>{const e=w(t);b(e.toString()),x(null),g(!0)},style:{width:"100%",padding:f.formElements.input.padding,background:"transparent",color:f.colors.brand.primary,border:`1px solid ${f.colors.brand.primary}`,borderRadius:f.formElements.input.borderRadius,cursor:"pointer",fontSize:f.typography.fontSizeBase,fontWeight:f.typography.fontWeightMedium,marginTop:"16px",marginBottom:v?"8px":"0",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background=f.colors.brand.primary,e.currentTarget.style.color="white"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.color=f.colors.brand.primary},children:["✏️ ",s||"Syötä lukema"]}),v&&(0,a.jsxs)("button",{onClick:()=>{const e=w(o);i(e)},style:{width:"100%",padding:f.formElements.input.padding,background:f.colors.text.secondary,color:"white",border:"none",borderRadius:f.formElements.input.borderRadius,cursor:"pointer",fontSize:f.typography.fontSizeBase,fontWeight:f.typography.fontWeightMedium,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:["↻ Palauta alkuperäinen (",o.split(" ")[0]," ",E,")"]})]})};function b(e){let{card:t,widgetMode:n=!1}=e;const i=p(),{formData:s,completeCard:l,uncompleteCard:d,cardStates:u,sessionId:f,updateField:m,submitData:b}=c(),[y,x]=(0,r.useState)(null),[v,S]=(0,r.useState)(null),[w,k]=(0,r.useState)(""),[_,j]=(0,r.useState)(!1),[C,E]=(0,r.useState)(null),[$,O]=(0,r.useState)([]),[T,R]=(0,r.useState)(null),[B,I]=(0,r.useState)(!1),[L,z]=(0,r.useState)(!1),A=(0,r.useRef)(!1),D=(0,r.useRef)({}),W=n&&"undefined"!=typeof window&&window.__E1_WIDGET_DATA?.formulas||[],N=n&&"undefined"!=typeof window&&window.__E1_WIDGET_DATA?.lookupTables||[];(0,r.useEffect)(()=>{if(_)console.log("Already calculating, skipping...");else try{(async()=>{try{const e=u[t.id],r=!0===e?.isRevealed,i="complete"===e?.status;if(!r)return void(A.current=!1);let a=!1;if($.length>0){const e={};for(const t of $)e[t]=s[t];a=JSON.stringify(e)!==JSON.stringify(D.current),a&&(console.log(`Dependencies changed for card ${t.id}:`,{old:D.current,new:e}),D.current=e)}if(A.current&&!a&&i)return;if(A.current=!1,!t.config?.main_result)return;A.current=!0,j(!0),E(null);try{let e;if(n){const o=new g(W,f,s,N);o.clearCache(),e=await o.process(t.config.main_result),console.log("WidgetCalculationCard received result:",e)}else{const{UnifiedCalculationEngine:r}=await o.e(846).then(o.bind(o,846)),{supabase:n}=await Promise.resolve().then(o.t.bind(o,215,23)),i=new r(n,f,s);e=await i.process(t.config.main_result),console.log("CalculationCard received result:",e)}if(e.success)try{let o=null;try{if(null!=e.result)if("[object Object]"===Object.prototype.toString.call(e.result)){const t=e.result;t&&"object"==typeof t&&void 0!==t.value?(o=String(t.value),t.unit&&(e.unit=t.unit)):t&&"object"==typeof t&&void 0!==t.result?(o=String(t.result),t.unit&&(e.unit=t.unit)):o=String(e.result)}else o=String(e.result)}catch(t){o=String(e.result||"0")}const r=o||"";let i="",a=r;const s=r.trim().split(/\s+/);s.length>1&&(i=s[s.length-1],a=s.slice(0,-1).join(" "));const c=parseFloat(a.replace(/\s/g,"").replace(",",".")),d=isNaN(c)?a:c.toLocaleString("fi-FI");if(x(d),S(d),k(i||e.unit||""),R(null),t.config?.field_name&&d)try{const e=parseFloat(d.replace(/\s/g,"").replace(",","."));isNaN(e)||m(t.config.field_name,e)}catch(e){}(t.config?.auto_complete_on_success||n)&&l(t.id)}catch(e){console.error("Error in result.success block:",e),E("Result processing failed: "+(e instanceof Error?e.message:String(e)))}else E(e.error||"Calculation failed");if(e.dependencies){O(e.dependencies);const t={};for(const o of e.dependencies)t[o]=s[o];D.current=t}const r=t.config.main_result.match(/\[(?:calc|lookup):([^\]]+)\]/);r&&R(r[1])}catch(e){console.error(`Error processing calculation for card "${t.name}":`,e),E(e instanceof Error?e.message:"Calculation failed")}finally{console.log("🔵 About to call setIsCalculating(false)");try{j(!1),console.log("✅ setIsCalculating(false) completed")}catch(e){console.error("❌ Error in finally block:",e)}}}catch(e){console.error("❌ Error in processCalculation:",e);try{E("Calculation failed: "+(e instanceof Error?e.message:String(e)))}catch(e){console.error("❌ Error setting error:",e)}}})()}catch(e){console.error("Error in processCalculation useEffect:",e),E("Calculation process failed: "+(e instanceof Error?e.message:String(e)))}},[t.id,t.config?.main_result,JSON.stringify(s),u[t.id]?.isRevealed,u[t.id]?.status,n]);const M="complete"===u[t.id]?.status,F=t.config?.show_submit_button&&y&&!M;return(0,a.jsxs)("div",{style:{padding:i.calculationCard.container.padding,background:i.calculationCard.container.background},children:[(t.title||t.config?.description)&&(0,a.jsxs)("div",{style:i.calculationCard.header,children:[(0,a.jsx)("h3",{style:i.calculationCard.title,children:t.title||t.name}),t.config?.description&&(0,a.jsx)("p",{style:i.calculationCard.description,children:t.config.description})]}),(0,a.jsx)("div",{style:i.calculationCard.resultSection,children:(0,a.jsx)("div",{style:i.calculationCard.resultDisplay,children:C?(0,a.jsx)("div",{style:i.calculationCard.errorMessage,children:C}):y&&t.config?.enable_edit_mode?(0,a.jsx)(h,{value:`${y}${w?` ${w}`:""}`,originalValue:`${v||y}${w?` ${w}`:""}`,unit:w||"",onUpdate:e=>{const o=String(e);if(x(o),t.config?.field_name&&o){const e=parseFloat(o.replace(/\s/g,"").replace(",","."));isNaN(e)||(m(t.config.field_name,e),console.log(`💾 Stored overridden result in field "${t.config.field_name}": ${e}`))}(t.config?.auto_complete_on_success||n)&&"complete"!==u[t.id]?.status&&l(t.id)},editButtonText:t.config?.edit_prompt||"Korjaa lukemaa",isCalculating:_}):y?(0,a.jsxs)("div",{style:i.calculationCard.resultDisplay,children:[(0,a.jsx)("div",{style:{fontSize:"2rem",fontWeight:"600"},children:String(y||"")}),(0,a.jsx)("div",{style:{fontSize:"1.2rem",color:"#6b7280"},children:w||(t.title?.includes("hinta")?"€":"kWh")})]}):(0,a.jsx)("div",{style:i.calculationCard.resultDisplay,children:"Syötä arvot yllä nähdäksesi laskelman"})})}),F&&(0,a.jsx)("button",{onClick:async()=>{if(!B){I(!0),z(!1);try{const e=t.config?.email_template||"default";await b(e),z(!0),l(t.id),console.log("✅ Form submitted successfully")}catch(e){console.error("❌ Error submitting form:",e),E(e instanceof Error?e.message:"Submission failed")}finally{I(!1)}}},disabled:B,style:{...i.submitButton,marginTop:"20px",width:"100%"},children:B?"Lähetetään...":L?"✓ Lähetetty":"Lähetä"})]})}function y(e){let{card:t,widgetMode:o=!1}=e;const n=p(),{completeCard:i,cardStates:s}=c();return(0,r.useEffect)(()=>{const e=s[t.id],o=e?.isRevealed;o&&!("complete"===e?.status)&&(console.log(`✅ Auto-completing info card: ${t.name}`),i(t.id))},[t.id,t.name,i,s]),(0,a.jsxs)("div",{style:{padding:n.card.base.padding,background:n.infoCard.background},children:[(t.title||t.config?.description)&&(0,a.jsx)("div",{style:n.card.header,children:(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("h3",{style:{fontSize:n.card.title.fontSize,fontWeight:n.card.title.fontWeight,color:n.card.title.color,lineHeight:n.card.title.lineHeight,marginBottom:n.card.title.marginBottom,letterSpacing:n.card.title.letterSpacing},children:t.title||t.name}),t.config?.description&&(0,a.jsx)("p",{style:{fontSize:n.card.description.fontSize,fontWeight:n.card.description.fontWeight,color:n.card.description.color,lineHeight:n.card.description.lineHeight,marginBottom:n.card.description.marginBottom},children:t.config.description})]})}),t.config?.content&&(0,a.jsx)("div",{style:{fontSize:n.infoCard.content.fontSize,color:n.infoCard.content.color,lineHeight:n.infoCard.content.lineHeight},dangerouslySetInnerHTML:{__html:t.config.content}})]})}function x(e){let{card:t,onFieldFocus:o}=e;const r="undefined"!=typeof window&&window.__E1_WIDGET_DATA;switch(t.type){case"form":return(0,a.jsx)(f,{card:t,onFieldFocus:o,widgetMode:r});case"calculation":return(0,a.jsx)(b,{card:t,onFieldFocus:o,widgetMode:r});case"info":return(0,a.jsx)(y,{card:t,widgetMode:r});default:return null}}var v=o(606);function S(e){let{activeCard:t,visualConfig:n,compact:i=!1,objectId:s,widgetMode:l=!1}=e;const c=p(),[d,u]=(0,r.useState)([]),[f,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),b=n||t?.visual_objects;console.log("🖼️ VisualSupport render:",{activeCardId:t?.id,activeCardName:t?.name,hasVisualObjects:!!t?.visual_objects,hasLinkedVisualObjectId:!!t?.config?.linked_visual_object_id,linkedVisualObjectId:t?.config?.linked_visual_object_id,visualObjectId:b?.id,visualObjectTitle:b?.title,visualConfigPassed:!!n,widgetMode:l,compact:i}),(0,r.useEffect)(()=>{(async()=>{if(!b?.id)return u([]),void h(!1);m(!0),h(!0);try{if(l){const e=b?.images||b?.visual_object_images||[];console.log("✅ Widget mode: Checking images:",{visualObjectId:b?.id,hasImages:e.length>0,imageCount:e.length,firstImage:e[0]?.cloudflare_image_id,visualObjectStructure:{hasImagesField:!!b?.images,hasVisualObjectImagesField:!!b?.visual_object_images}}),u(e)}else{console.log("🎯 Progressive loading: Fetching images for visual object:",b.id);const{supabase:e}=await Promise.resolve().then(o.t.bind(o,215,23)),{data:t,error:r}=await e.from("visual_object_images").select("*").eq("visual_object_id",b.id).order("display_order");r?(console.error("❌ Error fetching visual images:",r),u([])):(console.log("✅ Progressive load complete: Loaded",t?.length||0,"images"),u(t||[]))}}catch(e){console.error("❌ Error fetching visual images:",e),u([])}finally{m(!1)}})()},[b?.id,t?.id,l]);const y=e=>{if(l&&b?.image_url)return console.log("🔗 Using pre-constructed image URL from visual object:",b.image_url),b.image_url;if(l&&e?.image_url)return console.log("🔗 Using pre-constructed image URL from image object:",e.image_url),e.image_url;const t=e?.cloudflare_image_id||e?.cloudflareImageId,o=e?.variant||e?.image_variant||"public";if(!t)return console.error("❌ No Cloudflare image ID found:",e),null;const r=l?"undefined"!=typeof window&&window.__E1_WIDGET_DATA?.cloudflareAccountHash:v.env.NEXT_PUBLIC_CLOUDFLARE_ACCOUNT_HASH;if(console.log("🔧 Fallback to manual URL construction:",{widgetMode:l,accountHash:r?`${r.substring(0,8)}...`:"MISSING",cloudflareImageId:t,variant:o}),!r)return console.error("❌ Missing Cloudflare account hash for manual construction"),null;const n=`https://imagedelivery.net/${r}/${t}/${o}`;return console.log("🔗 Manually constructed image URL:",n),n},x=b?{title:b.title,description:b.description,hasImages:d.length>0}:t?{title:t.name,description:t.config?.description,hasImages:!1}:{title:null,description:null,hasImages:!1};return i?(0,a.jsxs)("div",{style:{background:c.visualSupport.content.background,padding:c.visualSupport.content.padding,display:"flex",alignItems:"center",gap:"16px",textAlign:"left",position:"relative",overflow:"hidden"},children:[x.hasImages&&d.length>0&&!f&&(()=>{const e=y(d[0]);return e?(0,a.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:t?`url(${e})`:"none",backgroundSize:"cover",backgroundPosition:"center",opacity:.3,zIndex:0}}):null})(),(0,a.jsxs)("div",{style:{flex:1,minWidth:0,position:"relative",zIndex:1},children:[x.title&&(0,a.jsx)("h2",{style:{fontSize:"18px",fontWeight:c.visualSupport.title.fontWeight,color:c.visualSupport.title.color,marginBottom:"4px",letterSpacing:c.visualSupport.title.letterSpacing},children:x.title}),x.description&&(0,a.jsx)("p",{style:{fontSize:"14px",fontWeight:c.visualSupport.subtitle.fontWeight,color:c.visualSupport.subtitle.color,lineHeight:c.visualSupport.subtitle.lineHeight,margin:0},children:x.description})]})]}):(0,a.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,a.jsx)("div",{style:{background:c.visualSupport.content.background,padding:x.hasImages&&d.length>0?"0":c.visualSupport.content.padding,display:c.visualSupport.content.display||"flex",flexDirection:c.visualSupport.content.flexDirection||"column",alignItems:c.visualSupport.content.alignItems||"center",justifyContent:c.visualSupport.content.justifyContent||"center",flex:c.visualSupport.content.flex||"1",minHeight:"400px",position:"relative",overflow:"hidden"},children:f?(0,a.jsx)("div",{style:{textAlign:"center",color:"#ffffff"},children:"Loading visual content..."}):x.hasImages&&d.length>0?(0,a.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:d.map((e,t)=>{const o=y(e);return console.log(`🖼️ Rendering image ${t+1}:`,{imageId:e.id,cloudflareId:e.cloudflare_image_id||e.cloudflareImageId,generatedUrl:o,imageObject:e}),o?(0,a.jsx)("img",{src:o,alt:x.title||"Visual content",loading:"lazy",style:{width:c.visualSupport.image.width||"100%",height:c.visualSupport.image.height||"100%",objectFit:c.visualSupport.image.objectFit||"cover",borderRadius:c.visualSupport.image.borderRadius},onLoad:()=>{console.log("✅ Image loaded successfully:",o)},onError:e=>{console.error("❌ Failed to load image:",o),console.error("❌ Image error details:",e),e.currentTarget.style.display="none"}},e.id):null})}):(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"64px",marginBottom:"16px",opacity:"0.8"},children:"📋"}),x.title&&(0,a.jsx)("h2",{style:{fontSize:c.visualSupport.title.fontSize,fontWeight:c.visualSupport.title.fontWeight,color:c.visualSupport.title.color,marginBottom:c.visualSupport.title.marginBottom,textAlign:c.visualSupport.title.textAlign,letterSpacing:c.visualSupport.title.letterSpacing},children:x.title}),(0,a.jsx)("p",{style:{fontSize:c.visualSupport.subtitle.fontSize,fontWeight:c.visualSupport.subtitle.fontWeight,color:c.visualSupport.subtitle.color,textAlign:c.visualSupport.subtitle.textAlign,lineHeight:c.visualSupport.subtitle.lineHeight},children:x.description||"No visual content available"})]})}),(0,a.jsx)("div",{style:{background:c.visualSupport.infoSection.background,padding:c.visualSupport.infoSection.padding,borderTop:c.visualSupport.infoSection.borderTop},children:(0,a.jsxs)("div",{style:{marginTop:c.visualSupport.infoSection.tip.marginTop,padding:c.visualSupport.infoSection.tip.padding,background:c.visualSupport.infoSection.tip.background,borderLeft:c.visualSupport.infoSection.tip.borderLeft,borderRadius:c.visualSupport.infoSection.tip.borderRadius,fontSize:c.visualSupport.infoSection.tip.fontSize,color:c.visualSupport.infoSection.tip.color,display:c.visualSupport.infoSection.tip.display},children:["💡"," ",b&&x.title?`${x.title}${x.description?` - ${x.description}`:""}`:t?`Vinkki: ${t.name} - Täytä kentät huolellisesti`:"Vinkki: Täytä kentät huolellisesti parhaan arvion saamiseksi"]})})]})}function w(e){let{onFieldFocus:t,activeCardId:o,forceShowInline:n,showBlurredCards:i=!1}=e;const{cards:s,shouldBeRevealed:l,cardStates:d}=c(),u=p(),f=(0,r.useRef)(null),[m,g]=(0,r.useState)({showTop:!1,showBottom:!1}),h=(0,r.useCallback)(()=>{const e=f.current;if(!e)return;const{scrollTop:t,scrollHeight:o,clientHeight:r}=e,n=o>r;g(e=>{const i={showTop:n&&t>10,showBottom:n&&t<o-r-10};return e.showTop===i.showTop&&e.showBottom===i.showBottom?e:i})},[]);(0,r.useEffect)(()=>{h()},[s.length]),(0,r.useEffect)(()=>{const e=f.current;if(e)return e.addEventListener("scroll",h),()=>e.removeEventListener("scroll",h)},[h]);const b=(0,r.useMemo)(()=>s.filter(e=>l(e)).sort((e,t)=>e.display_order-t.display_order),[s,l]),y=(0,r.useMemo)(()=>s.filter(e=>!l(e)).sort((e,t)=>e.display_order-t.display_order),[s,l]),v=o?s.find(e=>e.id===o):s.find(e=>e.visual_objects);return s.length?(0,a.jsxs)("div",{style:{position:"relative",height:"100%",width:"100%"},children:[(0,a.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,pointerEvents:"none",zIndex:10,transition:"opacity 500ms",opacity:m.showTop?1:0,height:"32px",background:"linear-gradient(180deg, rgba(255, 255, 255, 0.8) 0%, transparent 100%)"}}),(0,a.jsx)("div",{ref:f,style:{height:"100%",overflowY:"auto"},children:(0,a.jsxs)("div",{style:{padding:"30px",gap:"20px"},children:[(0,a.jsx)("div",{style:{height:"20px"}}),n&&(0,a.jsx)("div",{style:{display:n?"block":"none",marginBottom:"20px"},children:(0,a.jsx)("div",{style:{background:"#ffffff",borderRadius:"8px",overflow:"hidden"},children:(0,a.jsx)("div",{style:{height:"32px"},children:(0,a.jsx)(S,{activeCard:v,compact:!0})})})}),b.map((e,r)=>{const n=o===e.id,i="complete"===d[e.id]?.status;return(0,a.jsxs)("div",{id:`card-${e.id}`,style:{marginBottom:u.card.base.marginBottom,background:n?u.card.states.active.background:i?u.card.states.complete.background:u.card.base.background,borderRadius:u.card.base.borderRadius,overflow:u.card.base.overflow,borderTop:n?u.card.states.active.border:u.card.base.border||"1px solid #e5e7eb",borderRight:n?u.card.states.active.border:u.card.base.border||"1px solid #e5e7eb",borderBottom:n?u.card.states.active.border:u.card.base.border||"1px solid #e5e7eb",borderLeft:n?u.card.states.active.border:i?u.card.states.complete.borderLeft:u.card.base.border||"1px solid #e5e7eb",boxShadow:n?u.card.states.active.boxShadow:u.card.base.boxShadow,transform:n?u.card.states.active.transform:"scale(1)",opacity:i?u.card.states.complete.opacity:"1",transition:u.card.base.transition,position:"relative"},children:[i&&u.card.states.complete.checkmark?.enabled&&(0,a.jsx)("div",{style:{position:u.card.states.complete.checkmark.position,top:u.card.states.complete.checkmark.top,right:u.card.states.complete.checkmark.right,width:u.card.states.complete.checkmark.size,height:u.card.states.complete.checkmark.size,background:u.card.states.complete.checkmark.background,borderRadius:u.card.states.complete.checkmark.borderRadius,padding:u.card.states.complete.checkmark.padding,display:"flex",alignItems:"center",justifyContent:"center",color:u.card.states.complete.checkmark.color},children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M13.5 4.5L6 12L2.5 8.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,a.jsx)(x,{card:e,onFieldFocus:t})]},e.id)}),i&&y.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{height:"20px"}}),(()=>{const e=y[0];return(0,a.jsx)("div",{style:{marginBottom:u.card.base.marginBottom,background:u.card.base.background,borderRadius:u.card.base.borderRadius,overflow:u.card.base.overflow,border:u.card.base.border||"1px solid #e5e7eb",opacity:u.card.states.locked?.opacity||"0.6",filter:u.card.states.locked?.filter||"blur(8px)",pointerEvents:u.card.states.locked?.pointerEvents||"none",transform:u.card.states.locked?.transform||"scale(0.98)",transition:u.card.states.locked?.transition||"all 500ms ease",position:"relative"},children:(0,a.jsx)(x,{card:e,onFieldFocus:t})},`locked-${e.id}`)})()]})]})}),(0,a.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,pointerEvents:"none",zIndex:10,transition:"opacity 500ms",opacity:m.showBottom?1:0,height:"32px",background:"linear-gradient(0deg, rgba(255, 255, 255, 0.8) 0%, transparent 100%)"}})]}):(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("div",{style:{animation:"spin 1s linear infinite",borderRadius:"50%",height:"32px",width:"32px",border:"2px solid transparent",borderBottom:"2px solid #111827",margin:"0 auto 16px"}}),(0,a.jsx)("p",{style:{color:"#6b7280"},children:"Loading cards..."})]})})}function k(e){let{maxWidth:t,fullWidth:o=!1,className:n="",showVisualSupport:i=!0,height:s,forceMode:l,showBlurredCards:d=!1,widgetMode:u=!1}=e;const f=p(),{cards:m}=c(),g=t||f.container.maxWidth,[h,b]=(s||f.container.height,(0,r.useState)({})),y=o?{}:{maxWidth:"number"==typeof g?`${g}px`:g},x=i?f.layout.cardStreamRatio:"100%",v="mobile"===l,k=m.find(e=>e.id===h.cardId);let _=k?.visual_objects;if(u&&k?.config?.linked_visual_object_id){const e=window.__E1_WIDGET_DATA;console.log("🔍 Attempting to resolve visual object:",{activeCardId:k?.id,linkedId:k.config.linked_visual_object_id,hasWidgetData:!!e,hasVisualObjects:!!e?.visualObjects,visualObjectsKeys:e?.visualObjects?Object.keys(e.visualObjects):[]}),e?.visualObjects?(_=e.visualObjects[k.config.linked_visual_object_id],console.log("🎨 Widget mode: Resolved visual object:",{linkedId:k.config.linked_visual_object_id,found:!!_,title:_?.title,hasImages:_?.images?.length>0,imageCount:_?.images?.length||0})):console.warn("⚠️ No visual objects found in widget data")}return console.log("🏗️ CardSystemContainer state:",{totalCards:m.length,cardsWithVisuals:m.filter(e=>e.visual_objects||e.config?.linked_visual_object_id).length,activeContextCardId:h.cardId,activeCardName:k?.name,activeCardHasVisuals:!!_,widgetMode:u,isMobileMode:v,showVisualSupport:i,visualPanelVisible:i&&!v}),(0,r.useEffect)(()=>{if(!h.cardId&&m.length>0){const e=m.find(e=>e.visual_objects||u&&e.config?.linked_visual_object_id)||m[0];e&&(console.log("🎯 Auto-selecting card:",{cardId:e.id,cardName:e.name,hasVisual:!(!e.visual_objects&&!e.config?.linked_visual_object_id)}),b({cardId:e.id,fieldId:"auto_selected",value:"preview"}))}},[m.length,u]),(0,a.jsx)("div",{style:{margin:"0 auto",minHeight:f.container.minHeight,...y},children:(0,a.jsxs)("div",{style:{minHeight:f.container.minHeight,height:f.container.height,padding:0,display:"flex",flexDirection:"row",alignItems:"flex-start",gap:f.layout.gapBetweenPanels,position:"relative"},children:[i&&(0,a.jsx)("div",{style:{display:v?"none":"block",width:f.layout.visualSupportRatio,position:"sticky",top:f.visualSupport.sticky?.top||0,height:f.visualSupport.sticky?.height||"100vh",alignSelf:"flex-start",transform:f.visualSupport.sticky?.transform||"translate3d(0, 0, 0)",willChange:f.visualSupport.sticky?.willChange||"transform",backfaceVisibility:f.visualSupport.sticky?.backfaceVisibility||"hidden",background:f.visualSupport.background,borderRight:f.visualSupport.borderRight},children:(0,a.jsx)(S,{activeCard:k,visualConfig:_,compact:v,widgetMode:u})}),(0,a.jsx)("div",{style:{width:l&&v?"100%":i?x:"100%",minHeight:f.cardStream.minHeight||f.container.minHeight,height:f.cardStream.height||"100%",background:f.cardStream.background,flex:1,overflow:"hidden"},children:(0,a.jsx)(w,{onFieldFocus:(e,t,o)=>{console.log("🎯 onFieldFocus called:",{cardId:e,fieldId:t,value:o}),b({cardId:e,fieldId:t,value:o})},activeCardId:h.cardId,forceShowInline:v,showBlurredCards:d})})]})})}function _(e){return(0,r.useEffect)(()=>{e.widgetMode||(0,i.initializeCommonDependencies)()},[e.widgetMode]),e.widgetMode?(0,a.jsx)(k,{...e}):(0,a.jsx)(l,{initialData:e.initialData,widgetMode:e.widgetMode,children:(0,a.jsx)(k,{...e})})}const j=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,o)=>o?o.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},C=(...e)=>e.filter((e,t,o)=>Boolean(e)&&""!==e.trim()&&o.indexOf(e)===t).join(" ").trim(),E=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var $={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const O=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:o=2,absoluteStrokeWidth:n,className:i="",children:a,iconNode:s,...l},c)=>(0,r.createElement)("svg",{ref:c,...$,width:t,height:t,stroke:e,strokeWidth:n?24*Number(o)/Number(t):o,className:C("lucide",i),...!a&&!E(l)&&{"aria-hidden":"true"},...l},[...s.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(a)?a:[a]])),T=(e,t)=>{const o=(0,r.forwardRef)(({className:o,...n},i)=>{return(0,r.createElement)(O,{ref:i,iconNode:t,className:C(`lucide-${a=j(e),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,o),...n});var a});return o.displayName=j(e),o},R=T("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),B=T("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),I=T("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),L={network:{title:"Verkkovirhe",description:"Yhteysvirhe palvelimeen. Tarkista verkkoyhteytesi.",icon:"🌐"},config:{title:"Asetusvirhe",description:"Laskurin asetustiedosto on virheellinen tai puuttuu.",icon:"⚙️"},dependency:{title:"Resurssivirhe",description:"Tarvittava resurssi ei ole käytettävissä.",icon:"📦"},render:{title:"Näyttövirhe",description:"Laskurin näyttämisessä tapahtui virhe.",icon:"🖥️"},validation:{title:"Tietovirhe",description:"Ladatut tiedot ovat virheellisiä tai vioittuneita.",icon:"🔍"},timeout:{title:"Aikakatkaisuvirhe",description:"Pyyntö kesti liian kauan - yritä uudelleen.",icon:"⏱️"},permission:{title:"Käyttöoikeusvirhe",description:"Resurssin käyttö estettiin turvallisuussyistä.",icon:"🔒"},unknown:{title:"Tuntematon virhe",description:"Tapahtui odottamaton virhe.",icon:"❓"}},z=e=>{let{error:t,onRetry:o,onDismiss:r,isRetrying:n=!1,className:i=""}=e;const s=L[t.type]||L.unknown;return(0,a.jsx)("div",{className:`e1-error-display ${i}`,role:"alert",children:(0,a.jsxs)("div",{className:"e1-error-content",children:[(0,a.jsxs)("div",{className:"e1-error-header",children:[(0,a.jsxs)("div",{className:"e1-error-icon",children:[(0,a.jsx)(R,{className:"e1-error-icon-svg"}),(0,a.jsx)("span",{className:"e1-error-emoji",children:s.icon})]}),(0,a.jsxs)("div",{className:"e1-error-text",children:[(0,a.jsx)("h3",{className:"e1-error-title",children:s.title}),(0,a.jsx)("p",{className:"e1-error-description",children:s.description})]}),r&&(0,a.jsx)("button",{className:"e1-error-dismiss",onClick:r,"aria-label":"Sulje virheilmoitus",type:"button",children:(0,a.jsx)(B,{size:16})})]}),(0,a.jsxs)("div",{className:"e1-error-details",children:[(0,a.jsx)("p",{className:"e1-error-message",children:t.message}),t.details&&(0,a.jsxs)("details",{className:"e1-error-technical",children:[(0,a.jsx)("summary",{children:"Tekniset tiedot"}),(0,a.jsx)("pre",{className:"e1-error-code",children:t.details})]}),t.code&&(0,a.jsxs)("p",{className:"e1-error-code-inline",children:["Virhekoodi: ",(0,a.jsx)("code",{children:t.code})]}),t.retryCount&&t.retryCount>0&&(0,a.jsxs)("p",{className:"e1-error-retry-count",children:["Yrityskerta: ",t.retryCount+1,"/3"]})]}),(0,a.jsxs)("div",{className:"e1-error-actions",children:[t.retryable&&o&&(0,a.jsxs)("button",{className:"e1-error-retry-btn",onClick:o,disabled:n,type:"button",children:[(0,a.jsx)(I,{className:"e1-error-retry-icon "+(n?"spinning":""),size:16}),n?"Yritetään uudelleen...":"Yritä uudelleen"]}),!t.retryable&&(0,a.jsx)("p",{className:"e1-error-no-retry",children:"Ongelma vaatii manuaalista korjausta."})]}),(0,a.jsx)("div",{className:"e1-error-meta",children:(0,a.jsxs)("small",{className:"e1-error-timestamp",children:["Tapahtunut: ",t.timestamp.toLocaleString("fi-FI")]})})]})})},A=e=>{let{error:t,onRetry:o,isRetrying:r}=e;const n=L[t.type]||L.unknown;return(0,a.jsxs)("div",{className:"e1-error-compact",role:"alert",children:[(0,a.jsxs)("div",{className:"e1-error-compact-content",children:[(0,a.jsx)("span",{className:"e1-error-compact-icon",children:n.icon}),(0,a.jsx)("span",{className:"e1-error-compact-text",children:n.title}),t.retryable&&o&&(0,a.jsx)("button",{className:"e1-error-compact-retry",onClick:o,disabled:r,title:"Yritä uudelleen",type:"button",children:(0,a.jsx)(I,{className:r?"spinning":"",size:14})})]}),t.message&&(0,a.jsx)("div",{className:"e1-error-compact-message",children:t.message})]})},D=e=>{let{isLoading:t,error:o,onRetry:r,loadingText:n="Ladataan...",children:i}=e;return o?(0,a.jsx)(A,{error:o,onRetry:r,isRetrying:t}):t?(0,a.jsxs)("div",{className:"e1-loading-state",children:[(0,a.jsx)("div",{className:"e1-loading-spinner"}),(0,a.jsx)("p",{className:"e1-loading-text",children:n})]}):(0,a.jsx)(a.Fragment,{children:i})};class W extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:{type:"render",message:e.message,details:e.stack,retryable:!0,timestamp:new Date}}}componentDidCatch(e,t){const o={type:"render",message:e.message,details:`${e.stack}\n\nComponent Stack:\n${t.componentStack}`,retryable:!0,timestamp:new Date,context:{componentStack:t.componentStack}};console.error("🚨 React Error Boundary caught error:",o),this.props.onError&&this.props.onError(o)}handleRetry=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError&&this.state.error?(0,a.jsx)(z,{error:this.state.error,onRetry:this.handleRetry,className:"e1-error-boundary"}):this.props.children}}const N=[{pattern:/fetch.*failed|network.*error|connection.*refused|failed.*to.*fetch/i,type:"network",retryable:!0},{pattern:/ECONNREFUSED|ENOTFOUND|ETIMEDOUT/i,type:"network",retryable:!0},{pattern:/ERR_NETWORK|ERR_INTERNET_DISCONNECTED/i,type:"network",retryable:!0},{pattern:/timeout|timed.*out/i,type:"timeout",retryable:!0},{pattern:/request.*timeout|response.*timeout/i,type:"timeout",retryable:!0},{pattern:/CORS|cross.*origin|blocked.*by.*CORS/i,type:"permission",retryable:!1},{pattern:/403|forbidden|unauthorized|401/i,type:"permission",retryable:!1},{pattern:/config.*not.*found|invalid.*config|failed.*to.*load.*config/i,type:"config",retryable:!0},{pattern:/JSON.*parse|syntax.*error.*unexpected/i,type:"config",retryable:!1},{pattern:/config\.json.*404|config\.json.*not.*found/i,type:"config",code:"CONFIG_404",retryable:!0},{pattern:/dependency.*not.*found|module.*not.*found|script.*not.*loaded/i,type:"dependency",retryable:!0},{pattern:/404.*\.js|404.*\.css|resource.*not.*found/i,type:"dependency",retryable:!0},{pattern:/validation.*failed|invalid.*data|schema.*error/i,type:"validation",retryable:!1},{pattern:/cards.*not.*found|no.*cards.*available/i,type:"validation",code:"NO_CARDS",retryable:!1}],M={400:{type:"validation",retryable:!1},401:{type:"permission",retryable:!1},403:{type:"permission",retryable:!1},404:{type:"config",retryable:!0},408:{type:"timeout",retryable:!0},429:{type:"network",retryable:!0},500:{type:"network",retryable:!0},502:{type:"network",retryable:!0},503:{type:"network",retryable:!0},504:{type:"timeout",retryable:!0}},F={maxAttempts:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:2,jitter:!0};const H=new class{errorHistory=[];maxHistorySize=50;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.retryConfig={...F,...e}}classifyError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o="string"==typeof e?e:e.message,r="object"==typeof e?e.stack:void 0;let n;const i=o.match(/(\d{3})/);i&&(n=parseInt(i[1]));let a,s="unknown",l=!0;if(n&&M[n]){const e=M[n];s=e.type,l=e.retryable,a=`HTTP_${n}`}else for(const e of N){if(("string"==typeof e.pattern?new RegExp(e.pattern,"i"):e.pattern).test(o)){s=e.type,l=e.retryable,a=e.code;break}}const c={type:s,code:a,message:o,details:r,retryable:l,timestamp:new Date,context:{...t,userAgent:navigator.userAgent,httpStatus:n}};return this.addToHistory(c),c}calculateDelay(e){let t=this.retryConfig.baseDelay*Math.pow(this.retryConfig.backoffMultiplier,e);if(t=Math.min(t,this.retryConfig.maxDelay),this.retryConfig.jitter){const e=.25*t;t+=2*(Math.random()-.5)*e}return Math.max(t,100)}async retryOperation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=null;for(let r=0;r<this.retryConfig.maxAttempts;r++)try{const n={...t,retryAttempt:r,previousErrors:o?[o]:void 0};console.log(`🔄 Attempt ${r+1}/${this.retryConfig.maxAttempts}`,n);const i=await e();return r>0&&console.log(`✅ Operation succeeded after ${r+1} attempts`),i}catch(e){const n=this.classifyError(e,t);if(n.retryCount=r,o=n,console.error(`❌ Attempt ${r+1} failed:`,n),r===this.retryConfig.maxAttempts-1||!n.retryable)throw console.error(`🚨 Operation failed permanently after ${r+1} attempts`),n;const i=this.calculateDelay(r);console.log(`⏳ Waiting ${i}ms before retry ${r+2}`),await this.sleep(i)}throw o}async fetchWithRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={url:e,method:t.method||"GET",timestamp:new Date,userAgent:navigator.userAgent,...o};return this.retryOperation(async()=>{const o=new AbortController,r=setTimeout(()=>o.abort(),1e4);try{const n=await fetch(e,{...t,signal:o.signal});if(clearTimeout(r),!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);return n}catch(e){if(clearTimeout(r),e instanceof Error&&"AbortError"===e.name)throw new Error("Request timeout - server did not respond in time");throw e}},r)}async loadJSONWithRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=await this.fetchWithRetry(e,{},t);try{const t=await o.json();return console.log(`📦 Successfully loaded JSON from ${e}`),t}catch(t){throw new Error(`Failed to parse JSON response from ${e}: ${t}`)}}async loadResourceWithRetry(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.retryOperation(()=>new Promise((o,r)=>{let n;"script"===t?(n=document.createElement("script"),n.src=e,n.async=!0):(n=document.createElement("link"),n.rel="stylesheet",n.href=e),n.onload=()=>{console.log(`✅ Successfully loaded ${t} from ${e}`),o()},n.onerror=()=>{r(new Error(`Failed to load ${t} resource: ${e}`))},document.head.appendChild(n)}),{...o,url:e,method:"GET"})}addToHistory(e){this.errorHistory.unshift(e),this.errorHistory.length>this.maxHistorySize&&(this.errorHistory=this.errorHistory.slice(0,this.maxHistorySize))}getErrorStats(){const e={total:this.errorHistory.length,byType:{},recentErrors:this.errorHistory.slice(0,5),lastError:this.errorHistory[0]||null};return this.errorHistory.forEach(t=>{e.byType[t.type]=(e.byType[t.type]||0)+1}),e}clearHistory(){this.errorHistory=[]}sleep(e){return new Promise(t=>setTimeout(t,e))}enableDebugLogging(){var e=this;const t=console.error;console.error=function(){for(var o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];if(t.apply(console,r),r[0]&&"string"==typeof r[0]&&r[0].includes("E1 Calculator")){const t={timestamp:(new Date).toISOString(),message:r[0],data:r.slice(1),stack:(new Error).stack,errorHistory:e.getErrorStats()};try{const e=JSON.parse(sessionStorage.getItem("e1-debug-logs")||"[]");e.unshift(t),sessionStorage.setItem("e1-debug-logs",JSON.stringify(e.slice(0,20)))}catch(e){}}}}},U=(H.retryOperation.bind(H),H.fetchWithRetry.bind(H),H.loadJSONWithRetry.bind(H));H.loadResourceWithRetry.bind(H);var P=o(606);new Map;function G(e){let t="";return e.container&&(t+=`--e1-container-max-width: ${e.container.maxWidth}; `,t+=`--e1-container-padding: ${e.container.padding}; `,t+=`--e1-container-background: ${e.container.background}; `,t+=`--e1-container-border-radius: ${e.container.borderRadius}; `,t+=`--e1-container-box-shadow: ${e.container.boxShadow}; `),e.colors&&(e.colors.brand&&(t+=`--e1-color-primary: ${e.colors.brand.primary}; `,t+=`--e1-color-primary-hover: ${e.colors.brand.primaryHover}; `,t+=`--e1-color-primary-light: ${e.colors.brand.primaryLight}; `),e.colors.text&&(t+=`--e1-text-primary: ${e.colors.text.primary}; `,t+=`--e1-text-secondary: ${e.colors.text.secondary}; `,t+=`--e1-text-tertiary: ${e.colors.text.tertiary}; `,t+=`--e1-text-muted: ${e.colors.text.muted||"#6b7280"}; `),e.colors.background&&(t+=`--e1-bg-primary: ${e.colors.background.primary}; `,t+=`--e1-bg-secondary: ${e.colors.background.secondary}; `,t+=`--e1-bg-tertiary: ${e.colors.background.tertiary}; `),e.colors.state&&(t+=`--e1-state-success: ${e.colors.state.success}; `,t+=`--e1-state-error: ${e.colors.state.error}; `,t+=`--e1-state-warning: ${e.colors.state.warning}; `,t+=`--e1-state-info: ${e.colors.state.info}; `,t+=`--e1-state-error-bg: ${e.colors.state.errorBg||"#fef2f2"}; `,t+=`--e1-state-error-border: ${e.colors.state.errorBorder||"#fecaca"}; `,t+=`--e1-state-error-light: ${e.colors.state.errorLight||"#fee2e2"}; `)),e.spacing&&(t+=`--e1-spacing-xs: ${e.spacing.xs||"4px"}; `,t+=`--e1-spacing-sm: ${e.spacing.sm||"8px"}; `,t+=`--e1-spacing-md: ${e.spacing.md||"16px"}; `,t+=`--e1-spacing-lg: ${e.spacing.lg||"24px"}; `,t+=`--e1-spacing-xl: ${e.spacing.xl||"32px"}; `),t}async function K(e,t,o){try{console.log(`🔄 Loading config from: ${e}`);const o=await U(e,{widgetId:t,url:e});return console.log("✅ Successfully loaded widget config:",{version:o.version,cards:o.data?.cards?.length||0,visualObjects:Object.keys(o.data?.visualObjects||{}).length,formulas:o.data?.formulas?.length||0}),o}catch(e){throw console.error("❌ Failed to load config after all retries:",e),e}}const V=e=>{let{config:t,isolationMode:o="namespace",elementId:n}=e;const[i,s]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!0),[p,f]=(0,r.useState)(null),[m,g]=(0,r.useState)(null),[h,b]=(0,r.useState)(0),y=(0,r.useCallback)((e,r)=>{const i=H.classifyError(e,{widgetId:n,isolationMode:o,timestamp:new Date,userAgent:navigator.userAgent,retryAttempt:h});if(console.error(`🚨 Widget Error (${r||"Unknown"}):`,i),f(i),u(!1),t.onError&&t.onError(i),n){const e=document.getElementById(n);e&&e.dispatchEvent(new CustomEvent("e1-calculator-error",{detail:{error:i,context:r}}))}},[t.onError,n,o,h]),x=(0,r.useCallback)(async()=>{h>=(t.maxRetries||3)?console.warn("🚫 Maximum retry attempts reached"):(console.log(`🔄 Retrying widget initialization (attempt ${h+1})`),b(e=>e+1),f(null),u(!0),v())},[h,t.maxRetries]),v=(0,r.useCallback)(async()=>{try{u(!0),f(null),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.x,t=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;const r=t?{...e,...t}:e;if(o&&"host"in o){const e=o;let t=e.querySelector("#e1-design-tokens");t||(t=document.createElement("style"),t.id="e1-design-tokens",e.appendChild(t));const n=G(r);return void(t.textContent=`:host { ${n} }`)}const n=o||document.documentElement;G(r).split(";").forEach(e=>{const[t,o]=e.split(":").map(e=>e.trim());t&&o&&n.style.setProperty(t,o)})}(d.x,t.customTokens),t.cloudflareAccountHash&&(window.__E1_CLOUDFLARE_HASH=t.cloudflareAccountHash,P.env.NEXT_PUBLIC_CLOUDFLARE_ACCOUNT_HASH=t.cloudflareAccountHash);let e=null;try{if(!e&&t.apiUrl)try{console.log("🚀 Attempting to load fresh data from Vercel API:",t.apiUrl);const o=await K(t.apiUrl,n);e=o.data||o,console.log("✅ Successfully loaded data from Vercel API"),o.cloudflareAccountHash&&(window.__E1_CLOUDFLARE_HASH=o.cloudflareAccountHash,P.env.NEXT_PUBLIC_CLOUDFLARE_ACCOUNT_HASH=o.cloudflareAccountHash)}catch(e){console.warn("⚠️ API URL failed, falling back to config.json:",e)}if(!e&&"undefined"!=typeof window){const t=Object.keys(window).filter(e=>e.startsWith("E1_WIDGET_CONFIG_"));if(t.length>0){const o=window[t[0]];o&&(o.data||o.cards)&&(console.log("✅ Using WordPress config data as fallback"),e=o.data||o)}}if(!e&&t.data&&(console.log("✅ Using provided config data as fallback"),e=t.data),!e&&t.configUrl){console.log("🔄 Loading data from config.json URL as fallback");const o=await K(t.configUrl,n);e=o.data||o,o.cloudflareAccountHash&&(window.__E1_CLOUDFLARE_HASH=o.cloudflareAccountHash,P.env.NEXT_PUBLIC_CLOUDFLARE_ACCOUNT_HASH=o.cloudflareAccountHash)}if(!e)try{const t="/wp-content/plugins/e1-calculator-pro/cache/config.json";console.log("🔄 Trying default WordPress location as final fallback");const o=await K(t,n);e=o.data||o}catch(t){console.warn("Default location failed, checking for mock data"),window.__E1_MOCK_DATA&&(console.log("✅ Using mock data for development"),e=window.__E1_MOCK_DATA)}if(!e)throw new Error("No data available - check configUrl, provide data prop, or ensure WordPress plugin is properly configured");if(!e.cards||!Array.isArray(e.cards))throw new Error("Invalid data structure - cards array is missing or invalid");if(e=S(e),window.__E1_WIDGET_DATA={cards:e.cards||[],visualObjects:e.visualObjects||{},formulas:e.formulas||[],lookupTables:e.lookupTables||{},theme:e.theme||{},cloudflareAccountHash:t.cloudflareAccountHash||window.__E1_CLOUDFLARE_HASH,...e},console.log("✅ Widget data loaded successfully:",{cardCount:e.cards?.length||0,visualObjectCount:Object.keys(e.visualObjects||{}).length,cloudflareHash:window.__E1_CLOUDFLARE_HASH?"Available":"Missing"}),g(e),t.theme&&document.documentElement.setAttribute("data-theme",t.theme),s(!0),u(!1),n){const t=document.getElementById(n);t&&t.dispatchEvent(new CustomEvent("e1-calculator-loaded",{detail:{data:e,retryCount:h}}))}}catch(e){throw new Error(`Data loading failed: ${e instanceof Error?e.message:e}`)}}catch(e){y(e,"Data Loading")}},[t,n,y]),S=e=>e?(e.cards&&Array.isArray(e.cards)?(console.log(`✅ Processing ${e.cards.length} cards`),e.cards=e.cards.map(e=>(!e.card_fields&&e.fields&&(e.card_fields=e.fields,delete e.fields),e.card_fields||(e.card_fields=[]),e)),console.log(`✅ Cards processed successfully: ${e.cards.length} cards`)):console.warn("⚠️ No cards array found in data - this may cause rendering issues"),e):e;if((0,r.useEffect)(()=>{v()},[]),p)return(0,a.jsx)("div",{className:"e1-widget-container",children:(0,a.jsx)(z,{error:{...p,retryCount:h},onRetry:p.retryable&&!1!==t.enableRetry?x:void 0,isRetrying:c,className:"e1-widget-error"})});if(!i||!m)return(0,a.jsx)(D,{isLoading:c,error:p||void 0,onRetry:x,loadingText:"Ladataan laskuria..."});return(0,a.jsx)(W,{onError:y,children:(0,a.jsx)("div",{className:"e1-widget-container",children:(0,a.jsx)(l,{initialData:m,widgetMode:!0,children:(0,a.jsx)(_,{initialData:m,maxWidth:t.maxWidth,height:t.height,showVisualSupport:!1!==t.showVisualSupport,showBlurredCards:t.showBlurredCards,widgetMode:!0})})})})};new Map},540:function(e,t,o){"use strict";e.exports=o(869)},606:function(e){var t,o,r=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(o){try{return t.call(null,e,0)}catch(o){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{o="function"==typeof clearTimeout?clearTimeout:i}catch(e){o=i}}();var s,l=[],c=!1,d=-1;function u(){c&&s&&(c=!1,s.length?l=s.concat(l):d=-1,l.length&&p())}function p(){if(!c){var e=a(u);c=!0;for(var t=l.length;t;){for(s=l,l=[];++d<t;)s&&s[d].run();d=-1,t=l.length}s=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===i||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{return o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];l.push(new f(e,t)),1!==l.length||c||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},698:function(e,t){"use strict";var o=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function n(e,t,r){var n=null;if(void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),"key"in t)for(var i in r={},t)"key"!==i&&(r[i]=t[i]);else r=t;return t=r.ref,{$$typeof:o,type:e,key:n,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=n,t.jsxs=n},848:function(e,t,o){"use strict";e.exports=o(698)},869:function(e,t,o){"use strict";var r=o(606),n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),d=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,y={};function x(e,t,o){this.props=e,this.context=t,this.refs=y,this.updater=o||h}function v(){}function S(e,t,o){this.props=e,this.context=t,this.refs=y,this.updater=o||h}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=x.prototype;var w=S.prototype=new v;w.constructor=S,b(w,x.prototype),w.isPureReactComponent=!0;var k=Array.isArray,_={H:null,A:null,T:null,S:null,V:null},j=Object.prototype.hasOwnProperty;function C(e,t,o,r,i,a){return o=a.ref,{$$typeof:n,type:e,key:t,ref:void 0!==o?o:null,props:a}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var $=/\/+/g;function O(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(""+e.key,"$"+o.replace(/[=:]/g,function(e){return r[e]})):t.toString(36);var o,r}function T(){}function R(e,t,o,r,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||null;var l,c,d=!1;if(null===e)0;else switch(s){case"bigint":case"string":case"number":0;break;case"object":switch(e.$$typeof){case n:case i:0;break;case m:return R((0,e._init)(e._payload),t,o,r,a)}}if(d)return a(e),""===r?"."+O(e,0):r,k(a)?(null!=d&&d.replace($,"$&/")+"/",R(a,t,o,"",function(e){return e})):null!=a&&(E(a)&&(o+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace($,"$&/")+"/")+d,C(l.type,c,void 0,0,0,l.props)),t.push(a)),1;0;var u,p=""===r?".":r+":";if(k(e))for(var f=0;f<e.length;f++)R(e[f],t,o,p+O(r,f),a);else if("function"==typeof(null===e||"object"!=typeof u?null:"function"==typeof(g&&u[g]||u["@@iterator"])?u:null))for(f.call(e),0;!e.next().done;)R(r.value,t,o,p+O(r,f++),a);else if("object"===s){if("function"==typeof e.then)return R(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(T,T):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,o,r,a);throw String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return d}function B(e,t,o){if(null==e)return e;var r=[],n=0;return R(e,r,"","",function(e){return t.call(o,e,n++)}),r}function I(e){if(-1===e._status){var t=e._result;t().then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof r&&"function"==typeof r.emit)return void r.emit("uncaughtException",e);console.error(e)};function z(){}t.Component=x,t.createContext=function(e){return(e={$$typeof:d,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:c,_context:e},e},t.createElement=function(e,t,o){var r,n={},i=null;if(null!=t)for(r in void 0!==t.key&&(i=""+t.key),t)j.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(n[r]=t[r]);var a=arguments.length-2;if(1===a)n.children=o;else if(1<a){for(var s=Array(a),l=0;l<a;l++)s[l]=arguments[l+2];n.children=s}if(e&&e.defaultProps)for(r in a=e.defaultProps)void 0===n[r]&&(n[r]=a[r]);return C(e,i,void 0,0,0,n)},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.useCallback=function(e,t){return _.H.useCallback(e,t)},t.useContext=function(e){return _.H.useContext(e)},t.useEffect=function(e,t,o){var r=_.H;if("function"==typeof o)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},t.useMemo=function(e,t){return _.H.useMemo(e,t)},t.useRef=function(e){return _.H.useRef(e)},t.useState=function(e){return _.H.useState(e)}}},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={exports:{}};return i[e](o,o.exports,s),o.exports}s.m=i,e=[],s.O=function(t,o,r,n){if(!o){var i=1/0;for(d=0;d<e.length;d++){o=e[d][0],r=e[d][1],n=e[d][2];for(var a=!0,l=0;l<o.length;l++)(!1&n||i>=n)&&Object.keys(s.O).every(function(e){return s.O[e](o[l])})?o.splice(l--,1):(a=!1,n<i&&(i=n));if(a){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[o,r,n]},o=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},s.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var n=Object.create(null);s.r(n);var i={};t=t||[null,o({}),o([]),o(o)];for(var a=2&r&&e;("object"==typeof a||"function"==typeof a)&&!~t.indexOf(a);a=o(a))Object.getOwnPropertyNames(a).forEach(function(t){i[t]=function(){return e[t]}});return i.default=function(){return e},s.d(n,i),n},s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce(function(t,o){return s.f[o](e,t),t},[]))},s.u=function(e){return e+".namespaced.js"},s.miniCssF=function(e){},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r={},n="E1Calculator:",s.l=function(e,t,o,i){if(r[e])r[e].push(t);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+o){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",n+o),a.src=e),r[e]=[t];var p=function(t,o){a.onerror=a.onload=null,clearTimeout(f);var n=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach(function(e){return e(o)}),t)return t(o)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=p.bind(null,a.onerror),a.onload=p.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=o[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e}(),function(){var e={703:0,869:0};s.f.j=function(t,o){var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else if(869!=t){var n=new Promise(function(o,n){r=e[t]=[o,n]});o.push(r[2]=n);var i=s.p+s.u(t),a=new Error;s.l(i,function(o){if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+i+")",a.name="ChunkLoadError",a.type=n,a.request=i,r[1](a)}},"chunk-"+t,t)}else e[t]=0},s.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,n,i=o[0],a=o[1],l=o[2],c=0;if(i.some(function(t){return 0!==e[t]})){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(l)var d=l(s)}for(t&&t(o);c<i.length;c++)n=i[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},o=this.webpackChunkE1Calculator=this.webpackChunkE1Calculator||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var l=s.O(void 0,[869],function(){return s(489)});return l=(l=s.O(l)).E1CalculatorWidget}()});