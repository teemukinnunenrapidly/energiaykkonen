<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WordPress Style Demo - Energiaykkonen Calculator Embed</title>
    <style>
      /* WordPress-style CSS simulation */
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans,
          Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        background-color: #f1f1f1;
      }

      .wp-site-header {
        background: #23282d;
        color: white;
        padding: 1rem;
        text-align: center;
      }

      .wp-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 0;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .wp-content {
        padding: 2rem;
      }

      .wp-post {
        margin-bottom: 2rem;
      }

      .wp-post-title {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: #23282d;
      }

      .wp-post-meta {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #eee;
        padding-bottom: 1rem;
      }

      .wp-post-content {
        line-height: 1.8;
        color: #333;
      }

      .wp-post-content p {
        margin-bottom: 1.5rem;
      }

      /* Responsive embed container - WordPress style */
      .wp-embed-container {
        position: relative;
        margin: 2rem 0;
        padding: 1rem;
        background: #f8f9fa;
        border-left: 4px solid #0073aa;
        border-radius: 4px;
      }

      .embed-title {
        font-weight: bold;
        margin-bottom: 1rem;
        color: #0073aa;
      }

      .calculator-iframe {
        width: 100%;
        border: none;
        overflow: hidden;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: height 0.3s ease;
        background: white;
      }

      /* WordPress responsive breakpoints */
      @media (max-width: 782px) {
        .wp-content {
          padding: 1rem;
        }

        .wp-post-title {
          font-size: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .wp-content {
          padding: 0.5rem;
        }

        .wp-embed-container {
          margin: 1rem 0;
          padding: 0.5rem;
        }
      }

      /* Status indicators */
      .status-panel {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 1rem;
        margin: 1rem 0;
        font-family: monospace;
        font-size: 0.85rem;
      }

      .status-item {
        margin: 0.5rem 0;
        padding: 0.25rem 0;
      }

      .status-success {
        color: #28a745;
      }
      .status-warning {
        color: #ffc107;
      }
      .status-error {
        color: #dc3545;
      }
      .status-info {
        color: #17a2b8;
      }

      .wp-sidebar {
        background: #f8f9fa;
        padding: 1.5rem;
        border-left: 1px solid #ddd;
      }

      .wp-widget {
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .wp-widget-title {
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #23282d;
      }

      /* Two column layout for larger screens */
      @media (min-width: 768px) {
        .wp-main {
          display: grid;
          grid-template-columns: 2fr 1fr;
          gap: 2rem;
        }
      }

      .test-controls {
        background: #e8f4f8;
        padding: 1rem;
        border-radius: 4px;
        margin: 1rem 0;
      }

      .test-button {
        background: #0073aa;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 3px;
        cursor: pointer;
        margin: 0.25rem;
        font-size: 0.9rem;
      }

      .test-button:hover {
        background: #005a87;
      }

      .log-output {
        background: #f8f8f8;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 1rem;
        max-height: 300px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 0.8rem;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <header class="wp-site-header">
      <h1>üè† Energiaykk√∂nen - WordPress Site Demo</h1>
      <p>Testing Calculator iFrame Integration</p>
    </header>

    <div class="wp-container">
      <div class="wp-main">
        <main class="wp-content">
          <article class="wp-post">
            <h1 class="wp-post-title">
              L√§mp√∂pumpun Takaisinmaksuaika - Laske S√§√§st√∂si
            </h1>

            <div class="wp-post-meta">
              Published on <time datetime="2025-08-24">August 24, 2025</time> |
              Category: <a href="#">Energy Solutions</a> | Tags:
              <a href="#">Heat Pump</a>, <a href="#">Calculator</a>,
              <a href="#">Savings</a>
            </div>

            <div class="wp-post-content">
              <p>
                Miettitk√∂ l√§mp√∂pumpun hankkimista? T√§m√§ laskuri auttaa sinua
                selvitt√§m√§√§n l√§mp√∂pumpun takaisinmaksuajan ja vuosittaiset
                s√§√§st√∂t. Sy√∂t√§ tiedot alla olevaan laskuriin ja saat heti tarkan
                arvion.
              </p>

              <p>
                Laskuri ottaa huomioon nykyisen l√§mmitysj√§rjestelm√§si,
                kiinteist√∂n tiedot ja energian hinnat. Tulokset sis√§lt√§v√§t my√∂s
                CO2-p√§√§st√∂jen v√§henemisen arvion.
              </p>

              <!-- WordPress Embed Container -->
              <div class="wp-embed-container">
                <div class="embed-title">
                  üìä Interaktiivinen L√§mp√∂pumppu Laskuri
                </div>

                <iframe
                  id="energiaykkonen-calculator"
                  class="calculator-iframe"
                  src="http://localhost:3000/calculator"
                  scrolling="no"
                  frameborder="0"
                  allowtransparency="true"
                  title="Energiaykkonen Heat Pump Calculator"
                  style="height: 600px"
                  allow="clipboard-write"
                ></iframe>
              </div>

              <p>
                Laskuri toimii t√§ysin automaattisesti ja s√§√§t√§√§ korkeuttaan
                sis√§ll√∂n mukaan. Kaikki tiedot k√§sitell√§√§n turvallisesti eik√§
                henkil√∂kohtaisia tietoja tallenneta ilman suostumustasi.
              </p>

              <h3>Miksi valita l√§mp√∂pumppu?</h3>
              <ul>
                <li>Jopa 50-70% s√§√§st√∂ l√§mmityskustannuksissa</li>
                <li>Merkitt√§v√§ CO2-p√§√§st√∂jen v√§henem√§</li>
                <li>Kodin arvon nousu</li>
                <li>Valtion tuet saatavilla</li>
              </ul>
            </div>
          </article>

          <!-- Test Controls -->
          <div class="test-controls">
            <h3>üß™ Embed Testing Controls</h3>
            <p>Test the iframe integration and dynamic resizing:</p>

            <button class="test-button" onclick="simulateContentChange()">
              Simulate Content Change
            </button>
            <button class="test-button" onclick="testResponsive()">
              Test Responsive
            </button>
            <button class="test-button" onclick="resetIframe()">
              Reset iframe
            </button>
            <button class="test-button" onclick="toggleAutoResize()">
              Toggle Auto-Resize
            </button>
            <button class="test-button" onclick="clearLog()">Clear Log</button>

            <div class="status-panel">
              <div class="status-item">
                <strong>Integration Status:</strong>
                <span id="integration-status" class="status-info"
                  >Initializing...</span
                >
              </div>
              <div class="status-item">
                <strong>Messages Received:</strong>
                <span id="message-count" class="status-success">0</span>
              </div>
              <div class="status-item">
                <strong>Current Height:</strong>
                <span id="current-height" class="status-info">600px</span>
              </div>
              <div class="status-item">
                <strong>Auto-Resize:</strong>
                <span id="auto-resize-status" class="status-success"
                  >Enabled</span
                >
              </div>
            </div>

            <div class="log-output" id="log-output">
              [Initialized] WordPress embed demo loaded [Info] Waiting for
              calculator iframe messages...
            </div>
          </div>
        </main>

        <aside class="wp-sidebar">
          <div class="wp-widget">
            <h3 class="wp-widget-title">üìû Ota Yhteytt√§</h3>
            <p>Tarvitsetko apua l√§mp√∂pumpun valinnassa?</p>
            <p>
              <strong>Puh:</strong> 050 123 4567<br />
              <strong>Email:</strong> info@energiaykkonen.fi
            </p>
          </div>

          <div class="wp-widget">
            <h3 class="wp-widget-title">üîó Hy√∂dylliset Linkit</h3>
            <ul>
              <li><a href="#">L√§mp√∂pumppu Oppaat</a></li>
              <li><a href="#">Valtion Tuet</a></li>
              <li><a href="#">Asentaja Haku</a></li>
              <li><a href="#">Huoltosopimukset</a></li>
            </ul>
          </div>

          <div class="wp-widget">
            <h3 class="wp-widget-title">üìà Embed Analytics</h3>
            <div style="font-family: monospace; font-size: 0.8rem">
              <div>Iframe Loads: <span id="load-count">1</span></div>
              <div>Resize Events: <span id="resize-count">0</span></div>
              <div>Errors: <span id="error-count">0</span></div>
              <div>
                Cross-Origin:
                <span id="cors-status" class="status-success">OK</span>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <script>
      // WordPress-style embed integration script
      let autoResizeEnabled = true;
      let messageCount = 0;
      let resizeCount = 0;
      let loadCount = 1;
      let errorCount = 0;

      // DOM elements
      const iframe = document.getElementById('energiaykkonen-calculator');
      const logOutput = document.getElementById('log-output');
      const integrationStatus = document.getElementById('integration-status');
      const messageCountSpan = document.getElementById('message-count');
      const currentHeightSpan = document.getElementById('current-height');
      const autoResizeStatusSpan =
        document.getElementById('auto-resize-status');
      const resizeCountSpan = document.getElementById('resize-count');

      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logMessage = `[${timestamp}] ${message}\n`;
        logOutput.textContent += logMessage;
        logOutput.scrollTop = logOutput.scrollHeight;
      }

      function updateStatus(message) {
        integrationStatus.textContent = message;
        integrationStatus.className = 'status-success';
      }

      // Main message listener - WordPress integration
      window.addEventListener('message', function (event) {
        messageCount++;
        messageCountSpan.textContent = messageCount;

        // Log all messages for debugging
        log(`üì® Received: ${JSON.stringify(event.data)}`, 'info');

        // Handle calculator resize messages
        if (
          event.data &&
          event.data.type === 'calculator-resize' &&
          autoResizeEnabled
        ) {
          if (iframe && event.data.height) {
            const oldHeight = iframe.style.height;
            iframe.style.height = event.data.height + 'px';
            resizeCount++;
            resizeCountSpan.textContent = resizeCount;
            currentHeightSpan.textContent = event.data.height + 'px';

            log(`üìè Resized: ${oldHeight} ‚Üí ${event.data.height}px`, 'success');
            updateStatus(`Last resize: ${event.data.height}px`);
          }
        }
      });

      // Error handling
      iframe.addEventListener('error', function (event) {
        errorCount++;
        document.getElementById('error-count').textContent = errorCount;
        log(`‚ùå Iframe error: ${event.message || 'Unknown error'}`, 'error');
      });

      // Load event
      iframe.addEventListener('load', function () {
        log(`‚úÖ Iframe loaded successfully`, 'success');
        updateStatus('Iframe loaded, waiting for resize messages');
      });

      // Test functions
      function simulateContentChange() {
        // Simulate a form step change by manually adjusting height
        const randomHeight = Math.floor(Math.random() * 400) + 600;
        iframe.style.height = randomHeight + 'px';
        currentHeightSpan.textContent = randomHeight + 'px';
        log(`üîÑ Simulated content change: ${randomHeight}px`, 'test');
      }

      function testResponsive() {
        // Test different viewport sizes
        const sizes = ['300px', '768px', '1024px', '100%'];
        let index = 0;

        const interval = setInterval(() => {
          if (index >= sizes.length) {
            clearInterval(interval);
            iframe.style.width = '100%';
            log(`üì± Responsive test completed`, 'test');
            return;
          }

          iframe.style.width = sizes[index];
          log(`üì± Testing width: ${sizes[index]}`, 'test');
          index++;
        }, 1000);
      }

      function resetIframe() {
        iframe.style.height = '600px';
        iframe.style.width = '100%';
        currentHeightSpan.textContent = '600px';
        log(`üîÑ Iframe reset to default dimensions`, 'test');
      }

      function toggleAutoResize() {
        autoResizeEnabled = !autoResizeEnabled;
        const status = autoResizeEnabled ? 'Enabled' : 'Disabled';
        autoResizeStatusSpan.textContent = status;
        autoResizeStatusSpan.className = autoResizeEnabled
          ? 'status-success'
          : 'status-warning';
        log(`‚öôÔ∏è Auto-resize ${status.toLowerCase()}`, 'test');
      }

      function clearLog() {
        logOutput.textContent = '[Log cleared]\n';
        log('WordPress embed demo reinitialized', 'info');
      }

      // Initialize
      log('üéØ WordPress-style embed integration active', 'success');
      log('üì° Listening for calculator messages...', 'info');
      updateStatus('Ready - Monitoring iframe communication');

      // Monitor viewport changes for responsive testing
      window.addEventListener('resize', function () {
        log(
          `üìê Viewport changed: ${window.innerWidth}x${window.innerHeight}`,
          'info'
        );
      });

      // Check for CORS and security
      setTimeout(function () {
        try {
          // Test if we can communicate with iframe (should work)
          log(`üîí Security check: Cross-origin embedding working`, 'success');
          document.getElementById('cors-status').textContent = 'OK';
        } catch (e) {
          log(`üö® Security issue: ${e.message}`, 'error');
          document.getElementById('cors-status').textContent = 'ERROR';
          document.getElementById('cors-status').className = 'status-error';
        }
      }, 2000);
    </script>
  </body>
</html>
